
\subsection{Closed subtypes}

\begin{definition}%
  \begin{enumerate}[(a)]
  \item
    A \notion{closed proposition} is a proposition
    which is merely of the form $x_1 = 0 \land \dots \land x_n = 0$
    for some elements $x_1, \dots, x_n \in R$.
  \item
    Let $X$ be a type.
    A subtype $U : X \to \Prop$ is \notion{closed}
    if for all $x : X$, the proposition $U(x)$ is closed.
  \end{enumerate}
\end{definition}

\begin{proposition}[using \axiomref{sqc}]%
  There is an order-reversing isomorphism of partial orders
  \begin{align*}
    \text{f.g.-ideals}(R) &\xrightarrow{{\sim}} \Omega_{cl} \\
    I &\mapsto (I = (0))
  \end{align*}
  between the partial order of finitely generated ideals of $R$
  and the partial order of closed propositions.
\end{proposition}

\begin{proof}
  For a finitely generated ideal $I = (x_1, \dots, x_n)$,
  the proposition $I = (0)$ is indeed a closed proposition,
  since it is equivalent to $x_1 = 0 \land \dots \land x_n = 0$.
  It is also evident that we get all closed propositions in this way.
  What remains to show is that
  \[ I = (0) \Rightarrow J = (0)
     \qquad\text{iff}\qquad
     J \subseteq I
     \rlap{\text{.}}
  \]
  For this we use synthetic quasicoherence.
  Note that the set $\Spec R/I = \Hom_R(R/I, R)$ is a proposition
  (has at most one element),
  namely it is equivalent to the proposition $I = (0)$.
  Similarly, $\Hom_R(R/J, R/I)$ is a proposition
  and equivalent to $J \subseteq I$.
  But then our claim is just the equation
  \[ \Hom(\Spec R/I, \Spec R/J) = \Hom_R(R/J, R/I) \]
  which holds by Lemma~\ref{MISSING},
  since $R/I$ and $R/J$ are finitely presented $R$-algebras
  if $I$ and $J$ are finitely generated ideals.
\end{proof}

\begin{lemma}[using \axiomref{sqc}, \axiomref{loc}, \axiomref{Z-choice}]%
  \label{closed-subtype-affine}
  A closed subtype $C$ of an affine scheme $X=\Spec A$ is an affine scheme
  with $C=\Spec (A/I)$ for a finitely generated ideal $I\subseteq A$.
\end{lemma}

\begin{proof}
  By \axiomref{Z-choice} and boundedness,
  there is a cover $D(f_1),\dots,D(f_l)$, $C$ such that
  on each $D(f_i)$, $C$ is the vanishing set of functions
  \[ g_1,\dots,g_n:D(f_i)\to R\rlap{.} \]
  So by \cref{fg-ideal-local-global}, there is a finitely generated ideal $I\subseteq A$,
  such that $A_{f_i}\cdot I$ is $(g_1,\dots,g_n)$
  and $C=\Spec A/I$.
\end{proof}

\subsection{Irreducibility}
We have the following candidate for a definition of irreducibility:

\begin{definition}%
  \label{irred}
  A type $X$ is called \notion{irreducible},
  if for all pairs of closed subtypes $A:X\to \Prop$ and $B:X\to\Prop$ that cover $X$,
  we have $X=A$ or $X=B$.
\end{definition}

\begin{proposition}[using \axiomref{Z-choice}]%
  $\A^1$ is irreducible.
\end{proposition}
\begin{proof}
  Assume $A$ and $B$ as in the definition of irreducibility (\cref{irred}).
  Then there are $f,g:\A^1\to\A^1$ such that for all $x:\A^1$, $f(x)=0$ or $g(x)=0$.
  Without loss of generality and by \axiomref{Z-choice}, we can assume $f(x)=0$ for all $x:D(h)$,
  where $D(h)$ is a neighborhood of $0$.
  So $f=0$ by \cref{MISSING}.
\end{proof}

\subsection{Open subtypes}

While we usually drop the prefix ``qc'' in the definition below,
one should keep in mind, that we only use a definition of quasi compact open subsets.
The difference to general opens does not play a role so far,
since we also only consider quasi compact schemes later.

\begin{definition}%
  \label{qc-open}
  \begin{enumerate}[(a)]
  \item A proposition $P$ is \notion{(qc-)open}, if there merely are $f_1,\dots,f_n:R$,
    such that $P$ is equivalent to one of the $f_i$ being invertible.
  \item Let $X$ be a type.
    A subtype $U:X\to\Prop$ is \notion{(qc-)open}, if $U(x)$ is an open proposition for all $x:X$.
  \end{enumerate}
\end{definition}

\begin{proposition}[using \axiomref{sqc}, \axiomref{loc}]%
  \label{open-union-intersection}
  Let $X$ be a type.
  \begin{enumerate}[(a)]
  \item The empty subtype is open in $X$.
  \item $X$ is open in $X$.
  \item Finite intersections of open subtypes of $X$ are open subtypes of $X$.
  \item Finite unions of open subtypes of $X$ are open subtypes of $X$.
  \item Open subtypes are invariant under pointwise double-negation.
  \end{enumerate}
  Axioms are only needed for the last statement.
\end{proposition}

In \cref{open-subscheme} we will see that open subtypes of open subtypes of a scheme are open in that scheme.
Which is equivalent to open propositions being closed under dependent sums.

\begin{proof}[of \cref{open-union-intersection}]
  For unions, we can just append lists.
  For intersections, we note that invertibility of a product
  is equivalent to invertibility of both factors.
  For double-negation stability,
  we note that by \cref{MISSING},
  an open proposition $\exists_i f_i \mathrm{inv}$ is equivalent,
  to $(f_f,\dots,f_n)\neq 0$.
\end{proof}

\begin{lemma}[using \axiomref{sqc}]%
  Let $A$ be a finitely presented $R$-algebra
  and let $f, g_1, \dots, g_n \in A$.
  Then we have $D(f) \subseteq D(g_1, \dots, g_n)$
  as subsets of $\Spec A$
  if and only if $f \in \sqrt{(g_1, \dots, g_n)}$.
\end{lemma}

\begin{proof}
  Since $D(g_1, \dots, g_n) = \{\, x \in \Spec A \mid x \notin V(g_1, \dots, g_n) \,\}$,
  the inclusion $D(f) \subseteq D(g_1, \dots, g_n)$
  can also be written as
  $D(f) \cap V(g_1, \dots, g_n) = \varnothing$, that is,
  $\Spec((A/(g_1, \dots, g_n))[f^{-1}]) = \varnothing$.
  By (\axiomref{sqc})
  this means that the finitely presented $R$-algebra $(A/(g_1, \dots, g_n))[f^{-1}]$
  is zero.
  And this is the case if and only if $f$ is nilpotent in $A/(g_1, \dots, g_n)$,
  that is, if $f \in \sqrt{(g_1, \dots, g_n)}$, as stated.
\end{proof}

\begin{lemma}%
  \label{preimage-open}
  Let $f:X\to Y$ and $U:Y\to\Prop$ open,
  then the \notion{preimage} $U\circ f:X\to\Prop$ is open.
\end{lemma}

\begin{lemma}[using \axiomref{sqc}, \axiomref{loc}]%
  \label{open-inequality-subtype}
  Let $X$ be affine and $x:X$, then the proposition
  \[ x\neq y \]
  is open for all $y:X$.
\end{lemma}

\begin{proof}
  We show a proposition, so we can assume $\iota: X\to \A^n$ is a subtype.
  Then for $x,y:X$, $x\neq y$ is equivalent to $\iota(x)\neq\iota(y)$.
  But for $x,y:\A^n$, $x\neq y$ is the open propostion that $x-y\neq 0$.
\end{proof}

The intersection of all open neighborhoods of a point in an affine scheme,
is the formal neighborhood of the point.
We will see in \cref{intersection-of-all-opens}, that this also holds for schemes.

\begin{lemma}[using \axiomref{sqc}, \axiomref{loc}]%
  \label{affine-intersection-of-all-opens}
  Let $X$ be affine and $x:X$, then the proposition
  \[ \prod_{U:X\to \Open}U(x)\to U(y) \]
  is equivalent to $\neg\neg (x=y)$.
\end{lemma}

\begin{proof}
  By \cref{open-union-intersection}, $\neg\neg (x=y)$ implies $\prod_{U:X\to \Open}U(x)\to U(y)$.
  For the other implication,
  $\neg (x=y)$ is open \cref{open-inequality-subtype}, so we get a contradiction.
\end{proof}

We now show that our two definitions (\cref{affine-open}, \cref{qc-open})
of open subtypes of an affine scheme are equivalent.

\begin{theorem}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{qc-open-affine-open}
  Let $X=\Spec A$ and $U:X\to\Prop$ be an open subtype,
  then $U$ is affine open, i.e. there merely are $f_1,\dots,f_n:X\to R$ such that
  $U=D(f_1,\dots,f_n)$.
\end{theorem}

\begin{proof}
  Let $L(x)$ be the type of finite lists of elements of $R$,
  such that one of them being invertible is equivalent to $U(x)$.
  By assumption, we know
  \[\prod_{x:X}\|L(x)\|\rlap{.}\]
  So by \axiomref{Z-choice}, we have $s_i:\prod_{x:D(f_i)}L(x)$.
  We compose with the length function for lists to get functions $l_i:D(f_i)\to\N$.
  By \cref{boundedness}, the $l_i$ are bounded.
  Since we are proving a proposition, we can assume we have actual bounds $b_i:\N$.
  So we have functions $\tilde{s_i}:D(f_i)\to R^{b_i}$.
\end{proof}

This allows us to transfer one important lemma from affine-opens to qc-opens.
The subtlety of the following is that while it is clear that the intersection of two
qc-opens on a type, which are \emph{globally} defined is open again, it is not clear,
that the same holds, if one qc-open is only defined on the other.

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{qc-open-trans}
  Let $X$ be a scheme, $U\subseteq X$ qc-open in $X$ and $V\subseteq U$ qc-open in $U$,
  then $V$ is qc-open in $X$.
\end{lemma}

\begin{proof}
  Let $X_i=\Spec A_i$ be a finite affine cover of $X$.
  It is enough to show, that the restriction $V_i$ of $V$ to $X_i$ is qc-open.
  $U_i\colonequiv X_i\cap U$ is qc-open in $X_i$, since $X_i$ is qc-open.
  By \cref{qc-open-affine-open}, $U_i$ is affine-open in $X_i$,
  so $U_i=D(f_1,\dots,f_n)$.
  $V_i\cap D(f_j)$ is affine-open in $D(f_j)$, so by \cref{affine-open-trans},
  $V_i\cap D(f_j)$ is affine-open in $X_i$.
  This implies $V_i\cap D(f_j)$ is qc-open in $X_i$ and so is $V_i=\bigcup_{j}V_i\cap D(f_j)$.
\end{proof}

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{qc-open-sigma-closed}
  \begin{enumerate}[(a)]
  \item qc-open propositions are closed under dependent sums:
    if $P : \Open$ and $U : P \to \Open$,
    then the proposition $\sum_{x : P} U(x)$ is also open.
  \item Let $X$ be a type. Any open subtype of an open subtype of $X$ is an open subtype of $X$.
  \end{enumerate}
\end{lemma}

\begin{proof}
  \begin{enumerate}[(a)]
  \item Apply \cref{qc-open-trans} to the point $\Spec R$.
  \item Apply the above pointwise.
  \end{enumerate}
\end{proof}

\begin{remark}
  \Cref{qc-open-sigma-closed} means that
  the (qc-) open propositions constitute a \notion{dominance}
  in the sense of~\cite{Rosolini1986}.
\end{remark}

\subsection{Definition of schemes}

The following definition \emph{does not} define schemes in general,
but something which is expected to correspond to quasi-compact, quasi separated schemes,
locally of finite type externally.

\begin{definition}%
  \label{schemes}
  A type $X$ is a \notion{(qc-)scheme}\index{scheme}
  if there merely is a cover by finitely many open subtypes $U_i:X\to\Prop$,
  such that each of the $U_i$ is affine.
\end{definition}

\begin{definition}
  \label{type-of-schemes}
  We denote the \notion{type of schemes} with $\Sch$\index{$\Sch$}.
\end{definition}

Zariski-choice \axiomref{Z-choice} extends to schemes:

\begin{proposition}[using \axiomref{Z-choice}]%
  Let $X$ be a scheme and $P:X\to \Type$ with $\prod_{x:X}\|P(x)\|$,
  then there merely is a cover $U_i$ by standard opens of the affine parts of $X$,
  such that there are $s_i:\prod_{x:U_i}P(x)$ for all $i$.
\end{proposition}

\subsection{Connectedness}
The following is in conflict with the usual use of the word ``connected'' in homotopy type theory.

\begin{definition}%
  \label{connected}
  A pointed type $X$ is called \notion{connected},
  if any function $X\to \Bool$ is constant.
\end{definition}

\begin{proposition}[using \axiomref{sqc}, \axiomref{loc}]%
  \label{A1-connected}
  The set $\A^1$ is connected, that is,
  every function $f : \A^1 \to \Bool$ is constant.
\end{proposition}

\begin{proof}
  We embed $\Bool$ into $R$ as the subset $\{0, 1\} \subseteq R$.
  (We have $0 \neq 1$ in $R$ by (\axiomref{loc}).)
  Then we have a function $\widetilde{f} : \A^1 \to R$
  and we can assume $\widetilde{f}(0) = 0$.
  Note that $\widetilde{f}$ is an idempotent element of the algebra $R^{\A^1}$,
  since all its values are idempotent elements of $R$.
  By (\axiomref{sqc}),
  $\widetilde{f}$ is given by an idempotent polynomial $p \in R[X]$
  with $p(0) = 0$.
  But from this follows $p = 0$:
  we can factorize $p = X q$
  and then calculate $p = p^n = X^n q^n$
  to see that all coefficients of $p$ are zero.
\end{proof}

A connected scheme, that is covered by its point and everything except the point,
is already trivial.

\begin{corollary}%
  \label{connected-to-contractible}
  Let $X$ be a connected scheme and 
  \[\prod_{x:X}x=* \vee x\neq *.\]
  Then $X$ is contractible.
\end{corollary}

\begin{proof}
  Assume $\prod_{x:X}x=* \vee x\neq *$.
  Since for any proposition $P$, $P + \neg P$ is a proposition,
  we have $\prod_{x:X}x=* + x\neq *$ and there is a map to $\Bool$ from any binary copdoduct.
  So we have a map $X\to \Bool$
  which decides if a general $x:X$ is the point $*$ or not.
  By connectedness of $X$, this map is constant, but we know $*=*$,
  so $x=*$ for all $x$.
\end{proof}

\begin{corollary}[using \axiomref{sqc}, \axiomref{loc}]%
  $\neg(\prod_{x:\A^1}x=0 \vee x\neq 0)$
\end{corollary}

\begin{proof}
  By \cref{connected-to-contractible} and by the connectedness of $\A^1$ (\cref{A1-connected}),
  we can show from $\prod_{x:\A^1}x=0 \vee x\neq 0$ that $\A^1$ is contractible.
  This contradicts $1\neq 0$.
\end{proof}

%duplicate?
\begin{example}
  The ring $R$ is a local ring, so we have
  $\Pi_{x \in R} \propTrunc{\inv(x) \lor \inv(1 - x)}$,
  but we can prove that
  the statement without the propositional truncation is false:
  \[ \lnot \Pi_{x \in R} (\inv(x) \amalg \inv(1 - x)) \rlap{.} \]
  Namely,
  a witness of $\Pi_{x \in R} (\inv(x) \amalg \inv(1 - x))$
  is equivalently a function $f : R \to \Bool$
  with the property that
  \[ \text{if $f(x)$ then $\inv(x)$ else $\inv(1 - x)$} \rlap{.} \]
  But by $\cref{A1-connected}$,
  the function $f$ must be constant,
  contradicting the fact that
  $\lnot\inv(x)$ for $x = 0$ and $\lnot\inv(1 - x)$ for $x = 1$.

  In particular,
  not every type family $B : \A^1 \to \mU$ with $\Pi_{x : \A^1} \propTrunc{B(x)}$
  merely admits a choice function $\Pi_{x : \A^1} B(x)$.
\end{example}

\subsection{Compactness properties}

\Cref{boundedness} can be read as a compactness property
for countable disjoint open coverings of affine schemes,
since functions $f : \Spec A \to \N$
correspond to decompositions $\Spec A = \sum_{n : \N} U_n$,
and the subsets $U_n \subseteq X$ are automatically open
because they are detachable.

The following example shows that we can not expect all affine schemes
to be compact with respect to arbitrary set-indexed open coverings.

\begin{example}
  For $A$ a finitely presented $R$-algebra,
  consider the open cover ${(U_i)}_{i \in I}$,
  where the index set is $I = \Spec A$
  and for each $i$ we set $U_i = \Spec A = D(1)$.
  This indeed covers all points of $\Spec A$,
  since for every $x \in \Spec A$ we clearly have $x \in U_x$.
  To give a finite subcover of this cover, however,
  means to give a natural number $n$ and a function $\Fin n \to \Spec A$
  with the property that $\Spec A$ is empty if $n = 0$.
  In essence, it means to decide whether $\Spec A$ is inhabited or not.
  We claim that this is not possible for all finitely presented $R$-algebras:
  \[ \lnot (\Pi_{A : f.p. R\text{-Alg}} \propTrunc{\Spec A \amalg \lnot \Spec A} )
     \rlap{.} \]
  Indeed, for $A = R/(x)$,
  the proposition $\propTrunc{\Spec A \amalg \lnot \Spec A}$
  means $x = 0 \lor x \neq 0$,
  and we saw in~\ref{MISSING} that this is not true for all $x \in R$.
\end{example}

\subsection{Dense subtypes}

The following is probably used for lattices:

\begin{definition}
  A subtype $A\subseteq X$ is called \notion{dense},
  if for all open subtypes $V\subseteq X$ such that $V\cap A=\emptyset$, we have $V=\emptyset$.
\end{definition}

Being dense is a local property in the following sense:

\begin{lemma}[using \axiomref{sqc}, \axiomref{loc}, \axiomref{Z-choice}]%
  \label{dense-local}
  Let $X$ und $U_i\subseteq X$ be open subtypes for $i:I$ such that $\bigcup_{i:I}U_i=X$.
  Then $A\subseteq X$ is dense, if and only if, $A\cap U_i$ is dense in $U_i$.
\end{lemma}

\begin{proof}
  Let all $A\cap U_i$ be dense.
  To show that $A$ is dense, let $V\subseteq X$ be open and $V\cap A=\empty$.
  Then $\emptyset=V\cap A=\bigcup_{i:I}(V\cap U_i)\cap (A\cap U_i)$, so $(V\cap U_i)\cap (A\cap U_i)=\empty$ for all $i:I$.
  $V\cap U_i$ is open in $U_i$, so by assumption, $V\cap U_i=\emptyset$ for all $i:I$.
  So $V=\bigcup_{i:I}V\cap U_i=\emptyset$ and $A$ is dense.

  This is the part we use the axioms.
  On the other hand, let $A$ be dense in $X$ and for some $i:I$,
  let $V\subseteq U_i$ be open with $V\cap (U_i\cap A)=\emptyset$.
  Using \cref{qc-open-sigma-closed}, $V\subseteq X$ is open and $V\cap A=V\cap (U_i\cap A)=\emptyset$.
  So $V=\emptyset$.
\end{proof}

We will now characterize dense open subsets of affine schemes.

\begin{definition}
  Let $A$ be a commutative ring.
  \begin{enumerate}[(a)]
  \item An element $r:A$ is \notion{nilregular}, if for all $x:A$, such that $rx$ is nilpotent, $x$ is nilpotent.
  \item A list of elements $r_1,\dots,r_n:A$ is \notion{jointly nilregular}, if for all $x:A$,
    such that all $r_ix$ are nilpotent, $x$ is nilpotent.
  \end{enumerate}
\end{definition}

\begin{proposition}
  Any regular (\cref{regular-element}) element $r:A$ is nilregular.
\end{proposition}

\begin{lemma}[using \axiomref{sqc}, \axiomref{loc}, \axiomref{Z-choice}]%
  \label{affine-open-dense-nilregular}
  Let $X=\Spec A$ be affine and $U\subseteq X$ open.
  Then with $U$ is dense, if and only if,
  $U=D(r_1,\dots,r_n)$, with jointly nilregular $r_1,\dots,r_n:A$.
\end{lemma}

\begin{proof}
  Let $U\subseteq X$ be dense and open.
  By \cref{qc-open-affine-open}, there are $r_1,\dots,r_n:A$ such that $U=D(r_1,\dots,r_n)$.
  Let $x:A$ such that all $r_ix$ are nilpotent.
  By \cref{standard-open-empty}, this implies $D(r_ix)=\emptyset$ for all $i$.
  Since $D(x)\cap D(r_1,\dots,r_n)=D(r_1x)\vee\dots\vee D(r_nx)=\emptyset$,
  this implies $D(x)=\emptyset$.
  Therefore $x$ is nilpotent and the $r_i$ are jointly nilregular.

  Now let $U=D(r_1,\dots,r_n)$ with jointly nilregular $r_1,\dots,r_n:A$.
  Without loss of generality, let $V=D(f)$ and $D(f)\cap U=\emptyset$.
  Then $D(r_1f)\vee \dots \vee D(r_nf)=\emptyset$, so $D(r_if)=\emptyset$ for all $i$.
  This means $r_if$ is nilpotent and therefore, $f$ is nilpotent and $D(f)=\emptyset$.
\end{proof}

\begin{theorem}[using \axiomref{sqc}, \axiomref{loc}, \axiomref{Z-choice}]%
  Let $X$ be a scheme.
  An open subtype $U\subseteq X$ is dense,
  if and only if, there is an open affine cover $U_i=\Spec A_i$
  and $U\cap U_i=D(r_{i1},\dots,r_{in_i})$ with jointly nilregular $r_{i1},\dots,r_{in_i}:A_i$ for all $i$.
\end{theorem}

\begin{proof}
  By \cref{affine-open-dense-nilregular} and \cref{dense-local}.
\end{proof}
