\subsection{Definition and basic properties}

\begin{definition}
A Deligne-Mumford $\infty$-stack is a type $X$ such that:
\begin{itemize}
\item The type $X$ merely has a formally étale atlas. 
\item Coinductively, identity types in $X$ are Deligne-Mumford $\infty$-stacks.
\end{itemize}
\end{definition}

Deligne-Mumford $\infty$-stacks enjoys boundedness of map to $\N$, as well as étale-local choice.

\begin{definition}
An Artin $\infty$-stack is a type $X$ such that:
\begin{itemize}
\item The type $X$ merely has a formally smooth atlas. 
\item Identity types in $X$ are Deligne-Mumford $\infty$-stacks.
\end{itemize}
\end{definition}

Artin $\infty$-stacks enjoys boundedness of map to $\N$, as well as smooth-local choice.

\begin{definition}
A Deligne-Mumford (resp. Artin) $\infty$-stack that is an $n$-type is called a Deligne-Mumford (resp. Artin) $n$-stack.
\end{definition}

\begin{remark}
Our definition is unusual in several ways:
\begin{itemize}
\item We consider stacks without any truncation hypothesis, whereas traditionally one only consider Deligne-Mumford $0$-stacks (called algebraic spaces), Artin $1$-stacks (often called algebraic stacks) and Deligne-Mumford $0$-stacks (called Deligne-Mumford stacks). While it is unclear to us if considering $k$-stacks for $k>1$ is useful, setting things up this way allow us to factor proofs of results for $0$ and $1$-stacks.
\item Traditionally, identity types in algebraic spaces are assumed to be schemes that are propositions, whereas we just assume Deligne-Mumford $\infty$-stacks. We will see in \cref{TODO} that our hypothesis is less restrictive. We could mimic this by asking for a $-1$-stack to be a propositional scheme, and define inductively $n+1$-stacks as a type with an appropriate cover and $n$-stacks as identity types.

Our set up allow for smoother generalisation of properties, e.g. it is obvious for us that an $n+1$-stack that is an $n$-type is an $n$-stack, whereas this fails for $n=-1$ using the traditional definition)
\end{itemize}
Of we might change our mind in the future about how to set things up.
\end{remark}

\subsection{Basic stability results}

Here we prove that schemes are $\infty$-stacks and that $\infty$-stacks are stable by finite limits and the appropriate notion of quotient.

\begin{remark}
Contractible types are Deligne-Mumford $\infty$-stacks.
\end{remark}

\begin{lemma}
Schemes are Deligne-Mumford $\infty$-stacks.
\end{lemma}

\begin{proof}
Given a scheme $X$ its Zariski cover by affine schemes gives an étale atlas for $X$, using the fact that finite sums of open propositions are formally étale. Then we know that identity types in schemes are schemes and we can conclude coinductively.
\end{proof}

\begin{lemma}\label{sum-etale-etale}
Assume given $X$ a type with $Y_x$ a type depending on $x:X$. If we have a formally étale (resp. formally smooth) surjection:
\[p:U\to X\]
and for all $u:U$ a formally étale (resp. formally smooth) surjection:
\[q_x : V_u \to Y_{p(u)}\]
then the induced map in:
\[\sum_{u:U} V_u \to \sum_{x:X}Y_x\]
is a formally étale (resp. formally smooth) surjection.
\end{lemma}

\begin{proof}
Formally étale (resp. formally smooth) merely inhabited types are closed under dependent sums, and fibers of the induced maps are dependent sums of fibers of $p$ and some $q_x$, so they are formally étale (resp. formally smooth) and merely inhabited.
\end{proof}

Next result implies that Deligne-Mumford and Artin $\infty$-stacks are stable under finite limits, as it is obvious that they are stable under identity types.

\begin{proposition}\label{infty-stacks-sum}
Deligne-Mumford (resp. Artin) $\infty$-stacks are stable by dependent sums.
\end{proposition}

\begin{proof}
Assume given a Deligne-Mumford (resp. Artin) $\infty$-stacks $X$ and for all $x:X$ an algebraic space $Y_x$. We need to merely find a scheme-cover for $\sum_{x:X} Y_x$. 

For any $x:X$ we merely have:
\[\sum_{V_x:\mathrm{Scheme}} \sum_{q_x: V_x \to Y_x} q_x\ \mathrm{étale\ (resp.\ smooth)\ surjection}\]
So by étale-local (resp. smooth-local) choice for $X$, there merely is a scheme $U$ with an formally étale (resp. formally smooth) surjection $p: U \to X$ such that we merely have:
\[\prod_{u:U} \sum_{V_u:\mathrm{Scheme}} \sum_{q_u: V_u \to Y_{p(u)}} q_u\ \mathrm{étale\ (resp.\ smooth)\ surjection}\]
Then we merely have a scheme $\sum_{u:U}V_u$ with an induced map:
\[\sum_{u:U}V_u \to \sum_{x:X} Y_x\]
which is formally étale (resp. formally smooth) surjective by \cref{sum-etale-etale}.

Then we know that dependent sums commutes with identity so we can conclude coinductively.
\end{proof}

We can even do a bit better:

\begin{lemma}
Let us assume a pullback square:
 \begin{center}
    \begin{tikzcd}
      X\ar[d] & X\times_ZY\ar[d]\ar[l] \\
      Z & Y\ar[l]
    \end{tikzcd}
  \end{center}
 where $Y$ is an Artin $\infty$-stack and $X$ and $Y$ and Deligne-Mumford $\infty$-stack. Then:
 $X\times_ZY$ is a Deligne-Mumford $\infty$-stack.
\end{lemma}

Next result should be interpreted as saying that Deligne-Mumford and Artin $\infty$-stacks are stable under nice quotients:

\begin{proposition}\label{infty-stacks-quotients}
Assume given a type $Y$ such that there merely exists:
\begin{itemize} 
\item A Deligne-Mumford (resp. Artin) $\infty$-stack $X$.
\item A formally étale (resp. formally smooth) surjective map:
\[f:X\to Y\]
which fibers are Deligne-Mumford $\infty$-stacks. 
\end{itemize}
Then $Y$ is a Deligne-Mumford (resp. Artin) $\infty$-stack.
\end{proposition}

\begin{proof}
It is clear from the hypothesis that $Y$ has an étale (resp. smooth) atlas. Now we need to prove that identity types in $Y$ are Deligne-Mumford $\infty$-stack. But for all $x,x':X$ we have the following pullback square:
 \begin{center}
    \begin{tikzcd}
      \sum_{x:X}f(x)=_Yf(x')\ar[d] & f(x)=_Yf(x')\ar[d]\ar[l] \\
      X & 1\ar[l,"x"]
    \end{tikzcd}
  \end{center}
  Where $X$ is a Deligne-Mumford (resp. Artin) $\infty$-stack and $\sum_{x:X}f(x)=_Yf(x')$ is a Deligne-Mumford $\infty$-stack by hypothesis, so that for all $x,x':X$ we have that $f(x)=_Yf(x')$ is a Deligne-Mumford $\infty$-stack. We can conclude using the surjectivity of $f$.
\end{proof}

\subsection{$\infty$-stacks and group actions}

\begin{lemma}\label{delooping-stacks}
Let $G$ be a higher groups that is formally étale (resp. formally smooth) and a Deligne-Mumford $\infty$-stack. Then $BG$ is a Deligne-Mumford (resp. Artin) $\infty$-satck.
\end{lemma}

\begin{proof}
We use \cref{infty-stacks-quotients} on the map:
\[1\to BG\]
Indeed the fibers of this maps are all merely equivalent to $G$, so that they are Deligne-Mumford $\infty$-stack and formally étale (resp. formally smooth), as well as merely inhabited.
\end{proof}

\begin{corollary}
Let $G$ be a higher groups that is formally étale (resp. formally smooth) and a Deligne-Mumford $\infty$-stack. Assume $G$ acts on a Deligne-Mumford (resp. Artin) $\infty$-stack $X$. Then the homotopy quotient $X//G$ is a Deligne-Mumford (resp. Artin) $\infty$-stack.
\end{corollary}

\begin{proof}
By \cref{infty-stacks-sum} and \cref{delooping-stacks}.
\end{proof}

\subsection{$\infty$-stacks and exponentials}

\begin{lemma}
Assume given a type $A$ such that:
\begin{itemize}
\item The type $A$ has choice.
\item Given a family $X(a)$ of affine shemes for $a:A$, the type:
\[\prod_{a:A}X(a)\] 
has an étale (resp. smooth) atlas.
\end{itemize}
Then given a family $P(a)$ of Deligne-Mumford (resp. Artin) $\infty$-stack for $a:A$, the type:
\[\prod_{a:A}P(a)\]
is a Deligne-Mumford (resp. Artin) $\infty$-stack.
\end{lemma}

\begin{proof}
First we prove that we have an étale (resp. smooth) atlas for:
\[\prod_{a:A}P(a)\]
Indeed using choice for $A$, we merely get for all $a:A$ an affine scheme $X(a)$ and a formally étale (resp. formally smooth) map:
\[X(a)\to P(x)\]
The induced map:
\[\prod_{a:A}X(a) \to \prod_{a:A}P(a)\] 
is surjective because $A$ has choice, and formally étale using general proprieties of modalities (resp. formally smooth using the fact that $A$ has choice). But:
\[\prod_{a:A}X(a)\]
has an étale (resp. smooth) atlas by hypothesis and therefore so does:
\[\prod_{a:A}P(a)\]

The coinductive step is straightforward using the commutation of identity types and dependent products.
\end{proof}

TODO it seems to work for $P = \Spec(R[X]/X^2)$. How far can it be extended?

\subsection{A remark on the fundamental theorem for stacks}

Any surjective map:
\[f:X\to Y\]
morally means that $Y$ is the quotient of $X$ by a kind of $\infty$-pregroupoid structure on $X$ defined via:
\[\mathrm{Hom}(x,x') = f(x)=_Yf(x')\]
It is not possible to state this precisely because it would involve infinite towers of coherences that we don't know how to write down in HoTT. But when $X$ is an affine scheme and $Y$ is an $n$-type for $n$ low enough, it can be worked out it details. We will do this for $n<2$ in the rest of the notes, under the name of fundamental theorem for $n$-stacks.

