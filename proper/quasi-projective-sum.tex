
BEWARE, SECTION IN PROGRESS, By Hugo and Felix.

Here we go through the surprisingly long road giving quasi-projective schemes stable under dependent sums. At the moment, for projective schemes to be stable by dependent sums we are missing the following:
\begin{itemize}
\item $H^2(\bP^n,\A^\times) = 0$ 
\item $\mathrm{Aut}(\bP^n) = PGL_{n+1}$
\item Any locally free bundle on $\bP^n$ is becomes generated by global sections when twisted enough.
\end{itemize}


\subsection{Families of projective spaces being a projectivisation of a bundle}

In this section we prove that for any type $X$, if $H^2(X,\A^\times) = 0$ then any family of projective spaces over $X$ is the projectivisation of a bundle of finite free modules over $X$. Next two lemmas are about HoTT only, not SAG.

\begin{lemma}
Assume given a central extension:
\[0 \to A \to K \to G \to 0\]
Then the fibers of the induced map:
\[f:BK\to BG\]
are $BA$-torsors.
\end{lemma}

\begin{proof}
We know that the fibers are merely inhabited, 0-connected and 1-truncated, because this holds for the fiber over $*:BG$. So we just need to check that for all $x:BG$ and any point in $y:\mathrm{fib}_f(x)$ we have that:
\[(\mathrm{fib}_f(x),y) = (BA,*)\]
Since the fibers are 0-connected and 1-truncated, it is enough to show that:
\[(y=_{\mathrm{fib}_f(x)}y) \simeq_{\mathrm{Group}} A\]
to conclude. This is equivalent to saying that for all $y:BK$, we have:
\[\left(\sum_{p : y=_{BK}y} f(p) = \mathrm{refl}_{f(y)}\right) \simeq_{\mathrm{Group}} A\]
For $y=*$ this is immediate. Then we need to check that the induced conjugation action of $K$ on $A$ is the identity. But this follows from the assumed centrality of $A$ in $K$.
\end{proof}

\begin{remark}
With a bit more work, one can show that central extensions of $G$ by $A$ are classified by pointed maps from $BG$ to $B^2A$. Traditionally one only state that they have the same $0$-truncations, i.e. central extensions up to iso correspond to $H^2(G,A)$. 
\end{remark}

\begin{lemma}\label{trivial-cohomology-lift}
Assume given a central extension:
\[0 \to A \to K \to G \to 0\]
and a type $X$ such that $H^2(X,A)=0$. Then any map from $X$ to $BG$ factors through $BK$
\end{lemma}

\begin{proof}
By the previous lemma the map $BK\to BG$ is actually of the form:
\[\left(\sum_{x:BG} P(x)\right) \to BG\]
With $P(x)$ a $BA$-torsor for all $x:BG$. 

Given a map $f:X\to BG$, factoring it through $f$ means proving:
\[\prod_{x:X} P(f(x))\]
which in turns means proving that the $BA$-torsor:
\[P\circ f: X\to B^2A\]
is trivial. But since $H^2(X,A)=0$, this we merely have such a factorisation for any torsor.
\end{proof}

\begin{proposition}\label{auto-projective-central}
We have a central extension:
\[0 \to \A^\times \to GL_{n+1} \to Aut(\bP^n) \to 0\]
\end{proposition}

\begin{proof}
TODO, difficult, says $Aut(\bP^n) = PGL_{n+1}$. David has a sketch for $n=1$.
\end{proof}

A projective space is a type merely equal to $\bP^k$ for some $k$.

\begin{corollary}\label{projective-space-are-projectivisation-bundle}
Assume given $X$ such that $H^2(X,\A^\times) = 0$. Then any family of projective spaces over $X$ is the projectivisation of a bundle of finite free modules over $X$.
\end{corollary}

\begin{proof}
There is a well defined function from projective spaces to natural number giving the dimension, as if $\bP^m = \bP^n$ then we have $m=n$, for example by considering the tangent space at any chosen point. Given a family of projective space over $X$, we split $X$ as $\Sigma_{n:\N}X_n$ with the family having dimension $n$ on $X_n$. So we can assume the family having constant dimension.

Now a family of projective spaces of dimension $k$ over $X$ is a map $X\to BAut(\bP^n)$. By \cref{auto-projective-central} and \cref{trivial-cohomology-lift} we know this map lift through $BGL_{n+1}$, but the map:
\[BGL_{n+1} \to BAut(\bP^n)\]
though which we lift is precisely projectivisation, and we can conclude.
\end{proof}

\subsection{Projectivisation of a finite free line bundles over a projective space is projective scheme}

\begin{lemma}
A locally finite free bundle $M$ on a type $X$ is said to be globally generated if there exists $k:\N$ and:
\[\phi : (x:X) \to \Hom_R(R^k,V_x)\]
for all $x:X$ we have $\phi_x$ surjective.
\end{lemma}

\begin{lemma}\label{projectivisation-globally-generated-bundle-over-Pn-projective}
Assume given globally generated bundle $V$ of finite free module of $\bP^n$. Then:
\[\sum_{x:\bP^n}\bP(V^\star_x)\]
is a projective scheme.
\end{lemma}

\begin{proof}
TODO, easy
\end{proof}

\begin{lemma}\label{twisting-invariant-projectivisation}
Assume $V$ is a finite free module. Then for all finite free module $L$ of dimension $1$ we have that:
\[\bP(V) = \bP(\Hom_R(L,V))\]
\end{lemma}

\begin{proof}
TODO, easy
\end{proof}

\begin{lemma}\label{twisted-enough-globally-generated}
Assume given of locally finite free bundle on $\bP^n$. Then for $d$ large enough we have that $V(d)$ is globally generated.
\end{lemma}

\begin{proof}
TODO, hard... Know how to do it for sums of twisted canonical line bundles.
\end{proof}

\begin{lemma}\label{projectivisation-bundle-over-Pn-projective}
Assume given a bundle $V$ of finite free module over $\bP^n$. Then:
\[\sum_{x:\bP^n}\bP(V_x)\]
is a projective scheme.
\end{lemma}

\begin{proof}
By \cref{twisted-enough-globally-generated} we know that $V^\star(d)$ is globally generated for $d$ large enough. Then by \cref{projectivisation-globally-generated-bundle-over-Pn-projective} we know that:
\[\sum_{x:\bP^n}\bP((V^\star(d))^\star_x)\] 
is a projective scheme. Finally, for all $x:\bP^n$ we have that:
\[\bP((V^\star(d))^\star_x) = \bP(\Hom_R(\OO(d)_x,V_x)) = \bP(V_x)\]
by \cref{twisting-invariant-projectivisation} because $\OO(d)_x$ is free of dimension $1$. So we can conclude.
\end{proof}

\subsection{Projective schemes are stable under dependent sum}

\begin{lemma}\label{projective-2-cohomology-Ax-vanish}
We have that:
\[H^2(\bP^n,\A^\times) = 0\]
\end{lemma}

\begin{proof}
TODO
\end{proof}

\begin{proposition}
Assume given $X$ a projective scheme and $Y_x$ a family of projective schemes for $x:X$. Then the scheme $\sum_{x:X}Y_x$ is projective.
\end{proposition}

\begin{proof}
If $X$ is a closed proposition this is clear because closed propositions have choice. Then it is enough to show that for any family of projective spaces over $\bP^n$ their total space is a projective scheme. This holds since by \cref{projective-2-cohomology-Ax-vanish} and \cref{projective-space-are-projectivisation-bundle} the family is a projectivisation of a bundle of finite free modules, and then we conclude by \cref{projectivisation-bundle-over-Pn-projective}.
\end{proof}

\subsection{Projectivisation of a finite free line bundle over an open proposition is a quasi-projective scheme}

TODO

\subsection{Quasi-projective schemes are stable under dependent sum}

TODO
