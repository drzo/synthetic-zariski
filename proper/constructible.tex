In this section we introduce constructible sets and prove a version of Chevalley's theorem.

\begin{lemma}
  For a proposition $P$, the following are equivalent:
  \begin{itemize}
  \item $P$ can be expressed as $\neg \neg (b_1 \vee \ldots \vee b_n)$, with each $b_i$ 
    the conjunction of a standard open proposition and a closed proposition
  \item $P$ can be expressed as $\neg c_1 \wedge \ldots \wedge \neg c_m$, with each $c_j$
    the conjunction of a standard open proposition and closed proposition.
  \end{itemize}
  We say $P$ is \notion{constructible} if either condition merely holds.
  For a type $X$, we say a subtype $C : X \to \Prop$ is constructible if the proposition
  $C(x)$ is constructible for each $x : X$.
\end{lemma}
\begin{proof}
  Note that the second form is equivalent to $\neg (c_1 \vee \ldots \vee c_m)$.
  An expression like $b_1 \vee \ldots \vee b_n$ can be understood as the disjunctive
  normal form of a propositional formula built from propositions of the form $v = 0$.
  Hence, assuming excluded middle, the negation of such an expression is again of the
  same form. Since we are dealing only with negated statement, we may assume
  excluded middle, giving the desired result.
\end{proof}

\begin{lemma} We have the following.
    \begin{itemize}
    \item Open propositions are constructible. 
    \item The type of constructible propositions is closed under negation and conjunction. 
    \item Constructible propositions are $\neg \neg$-stable.
    \item The type of constructible propositions is a Boolean algebra, with join given by $\neg \neg (\varphi \vee \psi)$.
    \item This is a Boolean subalgebra of the Boolean algebra of $\neg \neg$-stable propositions.
    \end{itemize}
\end{lemma}

The proof is direct in each case. Constructible propositions are not closed under disjunction, 
for if $\neg \neg (u = 0) \vee \neg \neg (v = 0)$ were constructible, it would be equivalent to
$\neg \neg (uv = 0)$, but it is is even stronger than $uv = 0$.
We will soon see that the Boolean algebra of constructible propositions enjoys a certain universal
property, namely that of Joyal's constructible spectrum. First we need a more general lemma.

\begin{lemma}\label{embedding-free-boolean}
  Let $L$ be a distributive lattice and $B$ a boolean algebra. Let $f : L \to B$ be a map of
  lattices, and suppose
  \begin{itemize}
  \item each element of $B$ is generated from elements in the image of $f$ using logical connectives
  \item $f$ is an embedding.
  \end{itemize}
  Then $f$ exhibits $B$ as the free Boolean algebra on the distributive lattice $L$.
  \end{lemma}
Note that we do not claim this is a necessary condition; indeed many lattices do not embed in
Boolean algebras.
\begin{proof}
  We need to show that $B$ does not introduce more relations than necessary on expressions
  obtained from the image of $f$.
  Thus suppose given such a relation $x \le y$ in $B$. Writing $x$ in disjunctive normal and $y$ in conjunctive
  normal form, it suffices to consider a relation of the form
  $f(a) \wedge \neg f(b) \le f(c) \vee \neg f(d)$.
  This is equivalent by Boolean algebra laws to $f(a) \wedge f(d) \le f(c) \vee f(b)$, that is
  to $f(a \wedge d) \le f(c \vee b)$. Since $f$ is an embedding, we have $a \wedge d \le c \vee b$ already in $L$,
  as needed.
\end{proof}

\begin{theorem}\label{constructible-free-boolean}
  For a scheme $X$, the type of constructible subsets of $X$ is the free Boolean algebra on the lattice
  of open subsets of $X$.
\end{theorem}
\begin{proof}
  We apply \cref{embedding-free-boolean}. To verify the first condition, that constructible
  sets are generated by open sets by applying logical connectives, we pick an affine cover of
  $X$ and on each patch apply an argument analogous to the proof of
  \cite[Theorem 4.2.7]{draft}.
  The second condition, that open subsets embed in constructible subsets, is direct.
  Note that the inclusion of open subsets into construtible subsets is a lattice map,
  since $\varphi \vee \psi$ is equivalent to $\neg \neg (\varphi \vee \psi)$ for
  $\varphi$, $\psi$ open propositions.
\end{proof}

Finally we prove the main result about constructible subsets, a version of Chevalley's theorem.

\begin{theorem}
  Let $X$ be a scheme and $C : X \to \Prop$ a constructible subset of $X$.
  Then $(x : X) \to C(x)$ is constructible.
\end{theorem}
It follows by duality that $\neg \neg (x : X) \times C(x)$ is constructible.
This is closer to the usual statement that the image of a constructible set is constructible.
\begin{proof}
  We may assume $X = \Spec A$ is affine, by picking an affine cover and using that constructible propositions
  are closed under conjunction.
  Writing $\Spec A$ as a sigma-type and currying, it suffices to consider two cases:
  $A = R[x]$ and $A = R/(a)$.
  In each case we apply \cref{constructible-free-boolean} to write $C$
  in the form $x \mapsto \neg c_1(x) \wedge \ldots \wedge \neg c_n(x)$
  where $c_1$ is the intersection of a standard open subset of $\Spec A$ and
  a closed subset of $\Spec A$.
  
  In the case of $A = R/(a)$, we use surjectivity of the quotient map
  $R \to R/(a)$ to find one constructible proposition $\varphi$
  such that $C(x) = \varphi$ for all $x : X$. We claim
  that $(x : X) \to C(x)$ is
  equivalent to $\neg \neg (D(a) \vee \varphi)$, which is constructible.
  To see that these are equivalent, we note that both propositions are
  $\neg \neg$-stable, so we can prove the equivalence assuming law of excluded middle,
  which makes it direct.

  Now consider the case of $A = R[X]$. Since constructible propositions are closed under
  conjunction, we may suppose $C$ is of the form
  $x \mapsto \neg (D(p(x)) \wedge q_1(x) = \ldots = q_n(x) = 0)$, with
  $p, q_1,\ldots, q_n : R[X]$.
  Then $(x : X) \to C(x)$ is equivalent to the ring
  $R[X,p^{-1}]/(q_1,\ldots,q_n)$ being trivial, hence to
  $p$ being in the radical of $(q_1,\ldots,q_n)$.
  We apply \cref{euclid} to $q_1,\ldots,q_n$.
  We explain what to do when $(q_1,\ldots,q_n)$ is zero or generated by
  one monic polynomial $q$. In the first case, $(x : X) \to C(x)$
  is equivalent to the assertion that each coefficient of $p$ is nilpotent,
  which is a constructible proposition.
  
  In the second case, say $q$ is monic of degree $d$.
  We can divide $p^d$ by $q$ to obtain a list of $d$ elements of $R$.
  We claim that $(x : X) \to C(x)$ is equivalent to
  $\neg \neg (q \mid p^d)$, which is constructible
  since it asserts that some list of $d$ numbers is not not zero.
  The reverse implication is direct, using that $C(x)$ is $\neg \neg$-stable.
  For the forward implication, we suppose $(x : X) \to C(x)$, so
  that $q \mid p^N$ for some $N$, and want to derive a contradiction from
  the assumption $\neg (q \mid p^d)$.
  We appeal to \cite[lemma 3.4.3]{draft} to factorise $q$ into 
  powers of distinct linear factors. Since $q$ has degree $d$, each 
  exponent in this factorisation is at most $d$.
  Since $q \mid p^N$, each linear factor must not not divide $p$.
  Supposing each linear factor divides $p$, $q$ must divide $p^d$
  since the linear factors are coprime, as needed.
\end{proof}
