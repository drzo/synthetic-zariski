The goal of this section is to prove that projective space $\bP^n$ is compact,
a classical result of elimination theory.
We will first deal with the case $n = 1$, using algebraic methods, and
then deduce the general case.

The following lemma can be understood as a version of the Euclidean algorithm
for univariate polynomials in the abscence of decidable equality.
\begin{proposition}\label{euclid}
  Let $p_1, \ldots, p_n : R[X]$. Then we can find propositions
  $b_1,\ldots,b_r$, with each $b_i$ of the form $D(u) \wedge v_1 = \ldots = v_k = 0$,
  such that $\neg \neg (b_1 \vee \ldots \vee b_r)$,
  and for any $i$, we either have that $(p_1,\ldots,p_n) = 0$ if $b_i$ holds,
  or we have a natural $d$ such that if $b_i$ holds,
  then $(p_1,\ldots,p_n)$ is principal generated by a degree $d$ monic polynomial.
\end{proposition}
\begin{proof}[sketch]
  We suppose each $p_i$ is represented by a list of coefficients.
  If one of these lists is empty, we simply throw it away.
  If there is no $p_i$ left,
  then there is nothing left to prove: we take $r = 1$ and $b_1 = D(1)$,
  and note that $(p_1,\ldots,p_n) = 0$.
  Thus we may suppose $n \ge 1$, and take $i$ such that the formal degree
  of $p_i$ is the smallest. Let $u$ be the leading coefficient of $p_i$.
  We have $\neg \neg (D(u) \vee u = 0)$. 
  In either case, we can make progress: if $D(u)$ and $n = 1$,
  then $(p_1,\ldots,p_n)$ is $(p_i)$ with $p_i$ monic;
  if $D(u)$ and $n > 1$, then we can divide the other $p_j$ by $p_i$,
  decreasing their formal degrees;
  and if $u = 0$ then we can reduce the formal degree of $p_i$.
\end{proof}

\begin{lemma}\label{lorenzen}
  Let $A$ be an $R$-algebra, $J$ an ideal of $R$, and $x, y : A$ elements
  such that $xy = 1$. Suppose $1$ is in both $J[x]$ and $J[y]$.
  Then there is $m : J$  such that $m = 1$ in $A$.
\end{lemma}
\begin{proof}
  Write $1 = \sum_{i=0}^n a_ix^i = \sum_{j=0}^m b_j y^j$.
  Multiplying by $y^j$, we have
  $y^j = \sum_{i=0}^n a_j x^i y^j$.
  For $0 \le j \le m$, we have
  $x^i y^j \in \{y^m,y^{m-1},\ldots,y,1,x,\ldots,x^n\}$, since $xy = 1$.
  Hence $\langle y^m,\ldots,1,\ldots,x^n \rangle = J\langle y^m,\ldots,1,\ldots,x^n\rangle$.
  By Nakayama, there is $m : J$ such that $m \cdot 1 = 1$ in $A$.
\end{proof}

\begin{lemma}\label{elim-xy}
  Let $U_1 : \bP^1\setminus\{0\} \to \Open$ and
  $U_2 : \bP^1\setminus\{\infty\} \to \Open$ be open subsets of the two affine patches
  of the projective line.
  Then there merely is an open proposition $\varphi$, such that
  if $(x : \bP^1\setminus\{0\}) \to U_1(x)$ and
  $(x : \bP^1\setminus\{\infty\}) \to U_2(x)$ both hold, then $\varphi$ also holds,
  and if $\varphi$ holds, then for all $x : \bP^1\setminus\{0,\infty\}$,
  $U_1(x) \vee U_2(x)$ holds.
\end{lemma}
\begin{proof}
  By \cite[Theorem 4.2.7]{draft}, we have $U_1 = D(p_1,\ldots,p_n)$ and
  $U_2 = D(q_1,\ldots,q_m)$, where $p_i \in R[X]$ and $q_i \in R[Y]$.
  By applying \cref{euclid} twice and combining the results, 
  we can find propositions
  $b_1,\ldots,b_r$ with each $b_i$ of the form
  $D(u) \wedge v_1 = \ldots = v_k = 0$,
  so that for each $i$, both $(p_1,\ldots,p_n)$ 
  and $(q_1,\ldots,q_m)$ are principal when $b_i$ holds
  (in the strong sense: we know what the degree will be even without knowing $b_i$).
 
  Consider now an $i$ such that if $b_i$ holds, then
  $(p_1,\ldots,p_n)$ and $(q_1,\ldots,q_m)$ are both the unit ideal.
  Write $b_i$ as $D(u) \wedge v_1 = \ldots = v_k = 0$.
  Since $(p_1,\ldots,p_n)$ is the unit ideal if $b_i$ holds,
  we have that $(R[X]/(p_1,\ldots,p_n))^{b_i} = R[X,u^{-1}]/(p_1,\ldots,p_n,v_1,\ldots,v_k)$
  is trivial.
  Thus $1 \in J[X]$ in $R[X,u^{-1}]/(p_1,\ldots,p_n)$
  where $J = \langle v_1,\ldots,v_k\rangle$.
  In $R[x,y,u^{-1}]/(xy-1,p_1(x),\ldots,p_n(x),q_1(y),\ldots,q_m(y))$,
  we thus have $1 \in J[x]$ and $1 \in J[y]$.
  By \cref{lorenzen}, we have $m' : J$ such that $m' = 1$ in
  this ring.
  This means we have $m : J$, $N : \N$ such that $u^N = m$
  in $R[x,y]/(xy-1,p_1(x),\ldots,q_m(y))$.
  We take $\varphi$ to be the disjunction of
  $D(u^N-m)$ over all such $i$.

  We first verify that $U_1$ and $U_2$ cover their respective
  affine patches, then $\varphi$ holds.
  That is, we have to derive a contradiction from the assumption
  that $u^N-m = 0$ in $R$ for each $i$ as above.
  Since our goal is $\neg \neg$-stable, we may suppose given $i$
  such that $b_i$ holds. 
	Since $U_1$ and $U_2$ cover their respective affine patches,
	we actually do have that $(p_1,\ldots,p_n)$ and $(q_1,\ldots,q_m)$
	are both the unit ideal. Thus $i$ must be of the form above.
	But now $u$ is invertible and $m = 0$, contradicting $u^N-m = 0$.

	Next suppose $\varphi$ holds and $z : \bP^1 \setminus \{0,\infty\}$.
	We have to show $U_1(z) \vee U_2(z)$.
	We can write $z = [1 : x] = [y : 1]$ with $xy = 1$, so that
	we have to show
	$\neg (p_1(x) = \ldots = p_n(x) = q_1(y) = \ldots = q_m(y) = 0)$.
	Since we assume $\varphi$ holds, we can assume given an $i$
	such that $u^N - m$ is invertible in $R$.
	Since $u^N = m$ in
	the ring $R[x,y](xy-1,p_1,\ldots,q_m)$, this ring is trivial,
	so its spectrum is empty, as needed.
\end{proof}

\begin{theorem}\label{p1-compact}
	The projective line $\bP^1$ is compact.
\end{theorem}
\begin{proof}
	Let $U \subseteq \bP^1$ be open. Letting $U_1 = U \setminus\{0\}$ and
	$U_2 = U\setminus\{\infty\}$, take $\varphi$ as in \cref{elim-xy}.
	We claim that $(x : \bP^1) \to U(x)$ is equivalent to
	$U(0) \wedge U(\infty) \wedge \varphi$, which is clearly open.
	The forward implication is clear. For the reverse implication,
	observe that given $x : \bP^1$, we have
	$\neg \neg(x = 0 \vee x = \infty \vee \neg (x = 0 \vee x = \infty))$,
	and that $U(x)$ is $\neg \neg$-stable.
\end{proof}

\begin{theorem}
	For each $n$, $\bP^n$ is compact.
\end{theorem}
\begin{proof}
	We have to show that for any $R$-module $V$ which is free of finite rank,
	$\bP V$ is compact. We induct on $m = \dim V$.
	For $m\le 1$, this is clear, since finite types are compact.
	Thus suppose $m \ge 2$, so that we may pick $u,v : V$ linearly independent.

	Say a \emph{flag} in $V$ of rank $r$ is a sequence
	$0 = W_0 \subseteq W_1 \subseteq \ldots \subseteq W_r$
	of submodules of $V$ such that $W_{i+1} / W_i$ is free of rank 1 for each $i$.
	Let $F_r$ be the type of flags in $V$ of rank $r$ such that $W_1$ is
	contained in $\langle u,v\rangle$.

	We claim that $F_r$ is compact for each $r$. We prove this by induction on $r$.
	For $r = 1$, we have $F_1 = \bP \langle u, v \rangle = \bP^1$, which
	is compact by \cref{p1-compact}.
	An element of $F_{r+1}$ is given by an element $W_0,\ldots,W_r$ of $F_r$
	together with a point of $\bP (V / W_r)$.
	Since $V / W_r$ is free of rank $m - r < m$, $\bP(V/W_r)$ is compact by inductive
	hypothesis. Thus $F_{r+1}$ is compact, since compact types are closed under $\Sigma$.

	We define a map $F_{m-1} \to \bP V^\star$, where $V^\star$ is the dual module of $V$.
	A point of $\bP V^\star$ is equivalently a surjection
	$V \to Q$ where $Q$ is free of rank 1, and indeed we have such a
	surjection $V \to V/W_{m-1}$ for any point of $F_{m-1}$.
	
	We claim that this map satisfies the assumptions for \cref{not-not-surjection-compact}.
	Say given a point of $\bP V^\star$. We can represent it
	by a linear map $c : V \to R$. It is not not the case that
	$c(w) = 0$ for some non-zero $w : \langle u, v \rangle$, for
	if $c(u) \ne 0$ then we can take $w = v - \frac{c(v)}{c(u)} u$.
	Given such a $w$, we can extend it to a basis of $\ker\, c$, defining the
	desired point of $F_{m-1}$.

	Putting everything together, we conclude that $\bP V^\star$ is compact.
	Since $V^\star = V$, $\bP V$ is also compact as needed.
\end{proof}
