% latexmk -pdfxe -pvc main.tex
\documentclass{zariski}

\begin{document}

\begin{axiom}[Loc]%
  \label{loc}
  $R$ is a local ring.
\end{axiom}

\begin{axiom}[SQC]%
  \label{sqc}
  For any finitely presented $R$-algebra $A$, the homomorphism
  \[ a \mapsto (\varphi\mapsto \varphi(a)) : A \to (\Spec A \to R)\]
  is an isomorphism of $R$-algebras.
\end{axiom}

\ignore{
  AUGSBURG IDEAS:

  * Spec k[[X]] = D
  * Pushout of two schemes along open subscheme is scheme
  * for V : X \to R-Vect-n \bP(V) is scheme
  * P as space of line (in some vector space)
  * open/closed subsets are D(f) with values in a line bundle
  * define separated schemes, compare with 'inequality is an apartness relation'
  * separated => inequality is apartness  
  * define intersection (of curves) as pullbacks
  * define finite schemes
  * show good intersections are finite schemes?
  * show that dim (R^(intersection)) is the right thing (in examples)
    e.g. for curves in 2-dim. projective space, it should be the product of the degrees
  * irreducibility: (X irred :<=> (X=A∪B => X=A ∨ X=B)) shown for A^1, counterexample D(XY)
  
  }

\ignore{

(fp) Affine schemes
  
  local ring

  (Loc) R is a fixed local ring
  
  finitely presented algebra
  
  Spec

  _ : A -> R^(Spec A)
  _ : X -> Spec (R^X)

  coupled

  (SQC) Synthetic quasi coherence

  External justification

  is-affine

}

\begin{lemma}%
  \label{lem:kraus-glueing}
  Let $X$ and $I$ be types.
  For $(U_i:X \to \Prop)_{i:I}$ and $P:U_i\to \nType{0}$, we have the following glueing property: \\
  If for each $i:I$ there is a dependent function $s_i:(x:U_i)\to P(x)$ together with
  proofs of equality on intersections $p_{ij}:(x:U_i\cap U_j)\to (s_i(x)=s_j(y))$,
  then there is a globally defined dependent function $s:(x:X) \to P(x)$,
  such that for all $x:X$ and $i:I$ we have $U_i(x) \to s(x)=s_i(x)$
\end{lemma}
\begin{proof}
  We define $s$ pointwise.
  Let $x:X$.
  Using a Lemma of Kraus and the $p_{ij}$, we get a factorization
  \[ \begin{tikzcd}[row sep=0mm]
    \sum_{i:I} U_i(x) \ar[rr, "s_{\pi_1(\_)}(x)"]\ar[rd] & & P(x) \\
    & \|\sum_{i:I} U_i(x)\|_{-1}\ar[ru,dashed] &
  \end{tikzcd} \]
-- which defines a unique value $s(x):P(x)$.
\end{proof}

\begin{proposition}[\axiomref{sqc}, \axiomref{loc}]%
  \label{proposition:A1-connected}
  The set $\A^1$ is connected, that is,
  every function $f : \A^1 \to \Bool$ is constant.
\end{proposition}

\begin{proof}
  We embed $\Bool$ into $R$ as the subset $\{0, 1\} \subseteq R$.
  (We have $0 \neq 1$ in $R$ by (\axiomref{loc}).)
  Then we have a function $\widetilde{f} : \A^1 \to R$
  and we can assume $\widetilde{f}(0) = 0$.
  Note that $\widetilde{f}$ is an idempotent element of the algebra $R^{\A^1}$,
  since all its values are idempotent elements of $R$.
  By (\axiomref{sqc}),
  $\widetilde{f}$ is given by an idempotent polynomial $p \in R[X]$
  with $p(0) = 0$.
  But from this follows $p = 0$:
  we can factorize $p = X q$
  and then calculate $p = p^n = X^n q^n$
  to see that all coefficients of $p$ are zero.
\end{proof}

\begin{corollary}[\axiomref{sqc}, \axiomref{loc}, \axiomref{Z-choice}]%
  $\neg(\prod_{x:\A^1}x=0 \vee x\neq 0)$
\end{corollary}

\begin{proof}
  Assume $\prod_{x:\A^1}x=0 \vee x\neq 0$.
  By \axiomref{Z-choice} we get $s_i:(x:D(f_i))\to x=0 + x\neq 0$
  for a Zariski-cover $D(f_1),\dots,D(f_n)$ of $\A^1$. 
  On intersections $D(f_if_j)$, we have $s_i(x)=s_j(x)$
  since types of the form $P+\neg P$ for a proposition $P$ are propositions.
  This means we can use \cref{lem:kraus-glueing} to construct a map $\A^1\to \Bool$,
  which decides if $x$ is zero or not.
  By connectedness of $\A^1$, this map is constant, but we know $1\neq 0$,
  so both options for a constant value are impossible.
\end{proof}
\ignore{

Schemes
  we will only define quasi compact schemes  

  qc-open

  qc-Open subsets
  
  affine-open

}

\begin{definition}
  A \notion{closed proposition} is a proposition
  which is merely of the form $x_1 = 0 \land \dots \land x_n = 0$
  for some elements $x_1, \dots, x_n \in R$.
\end{definition}

\begin{proposition}[\axiomref{sqc}]
  There is an order-reversing isomorphism of partial orders
  \begin{align*}
    \text{f.g.-ideals}(R) &\xrightarrow{{\sim}} \Omega_{cl} \\
    I &\mapsto (I = (0))
  \end{align*}
  between the partial order of finitely generated ideals of $R$
  and the partial order of closed propositions.
\end{proposition}

\begin{proof}
  For a finitely generated ideal $I = (x_1, \dots, x_n)$,
  the proposition $I = (0)$ is indeed a closed proposition,
  since it is equivalent to $x_1 = 0 \land \dots \land x_n = 0$.
  It is also evident that we get all closed propositions in this way.
  What remains to show is that
  \[ I = (0) \Rightarrow J = (0)
     \qquad\text{iff}\qquad
     J \subseteq I
     \rlap{\text{.}}
  \]
  For this we use synthetic quasicoherence.
  Note that the set $\Spec R/I = \Hom_R(R/I, R)$ is a proposition
  (has at most one element),
  namely it is equivalent to the proposition $I = (0)$.
  Similarly, $\Hom_R(R/J, R/I)$ is a proposition
  and equivalent to $J \subseteq I$.
  But then our claim is just the equation
  \[ \Hom(\Spec R/I, \Spec R/J) = \Hom_R(R/J, R/I) \]
  which holds by Lemma~\ref{MISSING},
  since $R/I$ and $R/J$ are finitely presented $R$-algebras
  if $I$ and $J$ are finitely generated ideals.
\end{proof}

\begin{lemma}[\axiomref{sqc}]
  Let $A$ be a finitely presented $R$-algebra
  and let $f, g_1, \dots, g_n \in A$.
  Then we have $D(f) \subseteq D(g_1, \dots, g_n)$
  as subsets of $\Spec A$
  if and only if $f \in \sqrt{(g_1, \dots, g_n)}$.
\end{lemma}

\begin{proof}
  Since $D(g_1, \dots, g_n) = \{\, x \in \Spec A \mid x \notin V(g_1, \dots, g_n) \,\}$,
  the inclusion $D(f) \subseteq D(g_1, \dots, g_n)$
  can also be written as
  $D(f) \cap V(g_1, \dots, g_n) = \varnothing$, that is,
  $\Spec((A/(g_1, \dots, g_n))[f^{-1}]) = \varnothing$.
  By (\axiomref{sqc})
  this means that the finitely presented $R$-algebra $(A/(g_1, \dots, g_n))[f^{-1}]$
  is zero.
  And this is the case if and only if $f$ is nilpotent in $A/(g_1, \dots, g_n)$,
  that is, if $f \in \sqrt{(g_1, \dots, g_n)}$, as stated.
\end{proof}

\pagebreak

\section{Projective space}
\input{projective-space.tex}

\ignore{

  (Z-choice), (bound) => qc-open is affine-open
}

%duplicate
\begin{example}
  The ring $R$ is a local ring, so we have
  $\Pi_{x \in R} \propTrunc{\inv(x) \lor \inv(1 - x)}$,
  but we can prove that
  the statement without the propositional truncation is false:
  \[ \lnot \Pi_{x \in R} (\inv(x) \amalg \inv(1 - x)) \rlap{.} \]
  Namely,
  a witness of $\Pi_{x \in R} (\inv(x) \amalg \inv(1 - x))$
  is equivalently a function $f : R \to \Bool$
  with the property that
  \[ \text{if $f(x)$ then $\inv(x)$ else $\inv(1 - x)$} \rlap{.} \]
  But by Proposition $\ref{proposition:A1-connected}$,
  the function $f$ must be constant,
  contradicting the fact that
  $\lnot\inv(x)$ for $x = 0$ and $\lnot\inv(1 - x)$ for $x = 1$.

  In particular,
  not every type family $B : \A^1 \to \mU$ with $\Pi_{x : \A^1} \propTrunc{B(x)}$
  merely admits a choice function $\Pi_{x : \A^1} B(x)$.
\end{example}

\begin{axiom}[Z-choice]%
  \label{Z-choice}
  Let $A$ be a finitely presented $R$-algebra
  and let $B : \Spec A \to \mU$ be a family of inhabited types.
  Then there merely exists
  a finite list of coprime elements $f_1, \dots, f_n \in A$
  together with dependent functions $s_i : \Pi_{x : D(f_i)} B(x)$.
  As a formula:
  \[ (\Pi_{x : \Spec A} \propTrunc{B(x)}) \to
     \propTrunc{ \Sigma_{n : \N} \Sigma_{f_1, \dots, f_n : A}
      ((f_1, \dots, f_n) = (1)) \times
      \Pi_i \Pi_{x : D(f_i)} B(x) }
     \rlap{.}
  \]
\end{axiom}

\begin{theorem}[using (\axiomref{loc}), (\axiomref{sqc})]%
  Let $A$ be a finitely presented $R$-algebra.
  Then every function $f : \Spec A \to \N$ is bounded:
  \[ \Pi_{f : \Spec A \to \N} \propTrunc{\Sigma_{n : \N} \Pi_{x : \Spec A} f(x) \le n}
     \rlap{.} \]
\end{theorem}

\begin{proof}
  Let $f : \Spec A \to \N$ be given.
  We compose this function with the embedding
  \[ \begin{tikzcd}[row sep=0mm]
    \N \ar[r, "\iota"] & R[X] \ar[r, phantom, "{=}"] & (\bA^1 \to R) \\
    n \ar[r, mapsto] & X^n
  \end{tikzcd} \]
  (it is an embedding since $1 \neq 0 \in R$ by (\axiomref{loc}))
  to obtain $\widetilde{f} : \Spec A \to (\bA^1 \to R)$
  and its transpose $g : \Spec A \times \bA^1 \to R$.
  Since $\Spec A \times \bA^1 = \Spec (A \otimes R[X]) = \Spec A[X]$
  (see~\ref{MISSING}),
  we can regard $g$ as an element of $A[X]$.
  For $x \in \Spec A$,
  the polynomial $\iota(f(x)) \in R[X]$ is then obtained from the polynomial~$g$
  by applying the $R$-algebra homomorphism $x : A \to R$ to all coefficients.
  This makes it clear that
  we have a common bound on the degrees of the polynomials $\iota(f(x))$,
  in other words,
  the function $f$ is bounded.
\end{proof}

The following example shows that we can not expect all affine schemes
to be compact with respect to arbitrary set-indexed open coverings.

\begin{example}
  For $A$ a finitely presented $R$-algebra,
  consider the open cover ${(U_i)}_{i \in I}$,
  where the index set is $I = \Spec A$
  and for each $i$ we set $U_i = \Spec A = D(1)$.
  This indeed covers all points of $\Spec A$,
  since for every $x \in \Spec A$ we clearly have $x \in U_x$.
  To give a finite subcover of this cover, however,
  means to give a natural number $n$ and a function $\Fin n \to \Spec A$
  with the property that $\Spec A$ is empty if $n = 0$.
  In essence, it means to decide whether $\Spec A$ is inhabited or not.
  We claim that this is not possible for all finitely presented $R$-algebras:
  \[ \lnot (\Pi_{A : f.p. R\text{-Alg}} \propTrunc{\Spec A \amalg \lnot \Spec A} )
     \rlap{.} \]
  Indeed, for $A = R/(x)$,
  the proposition $\propTrunc{\Spec A \amalg \lnot \Spec A}$
  means $x = 0 \lor x \neq 0$,
  and we saw in~\ref{MISSING} that this is not true for all $x \in R$.
\end{example}

\ignore{
  external justification of zariski-local-choice

  def qc-scheme
    example: qc-open proposition

  discuss alternative definitions (of open and scheme)

projective space
  functions on P^n are constant
 
  line bundles?

cohomology

  explanation: structure sheaf - why R?

  def: cohomology as 0-trunc((x:X) -> K(A_x,n))

  is-connected(R-torsors on Spec A)

  cohomology of twisting sheaves on P^n?

}

\section{Bundles and cohomology}
\input{cohomology.tex}
\end{document}
