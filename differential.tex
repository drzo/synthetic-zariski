\subsection{The Tangent Space}

We will use the concept of tangent spaces from synthetic differential geometry.
More concretely, we follow \cite{david-orbifolds}[Section 4]
on the subject, which also uses homotopy type theory as a basis.

\begin{definition}
  The \notion{first order disk}\index{$\D(n)$} of dimension $n$ is the type
  \[ \D(n)\colonequiv \{x:R^n \mid xx^T = 0 : R^{n \times n}\}\rlap{.}\]
\end{definition}

By definition, the first order disks are affine, since
\[
  \{x:R^n \mid xx^T = 0 : R^{n \times n}\} = \Spec R[X_1,\dots,X_n]/(X\cdot X^T)
\]
-- with $X=(X_1,\dots,X_n)$.
We will describe these algebras more explicitly.

\begin{lemma}%
  For all $n:\N$,
  \[
    R[X_1,\dots,X_n]/(X\cdot X^T) = R+\epsilon_1R+\dots+\epsilon_nR
  \]
  as $R$-algebras, where $\epsilon_i\epsilon_j=0$.
\end{lemma}

The first order disks are quite convenient to work with,
as shown in the following example of a tangent bundle\index{tangent bundle},
which we will define below.

\begin{example}[using \axiomref{sqc}]%
  Let $S\colonequiv\Spec R[X,Y]/(X^2+Y^2-1)$.
  We will see that $S^{\D(1)}$ is affine by the following calculation:
  \begin{align*}
    S^{\D(1)} &= \Spec R[\epsilon] \to \Spec R[X,Y]/(X^2+Y^2-1) \\
              &= \Hom_R(R[X,Y]/(X^2+Y^2-1), R[\epsilon]) \\
              &= \sum_{z,w:R[\epsilon]}z^2+w^2=1 \\
              &= \sum_{x+\epsilon u, y+\epsilon v:R+\epsilon R}(x+\epsilon u)^2+(y+\epsilon v)^2=1 \\
              &= \sum_{x,y,u,v:R} x^2+y^2+\epsilon (2xu+2yv)=1 \\
              &=\sum_{x,y,u,v:R}(x^2+y^2=1)\times(2xu+2yv=0) \\
    &=\Spec R[X,Y,U,V]/(X^2+Y^2-1,2XU+2YV)
  \end{align*}
\end{example}

More generally than first order disks, we can consider infinitesimal varieties:

\begin{definition}
  \begin{enumerate}[(a)]
  \item A \notion{Weil algebra} over $R$ is a finitely presented $R$-algebra
    $W$ together with a homomorphism $\pi : W \to R$, such that the kernel of $\pi$ is a nilpotent ideal.
  \item An \notion{infinitesimal variety} is a pointed type $D$,
    such that $D = (\Spec W, \pi)$ for a Weil algebra $(W, \pi)$.
  \end{enumerate}
\end{definition}

Note that the kernel of $\pi$ is a finitely generated ideal,
as the kernel of a surjective homomorphism between finitely presented algebras.
To ask that $\ker \pi$ is nilpotent as an ideal
is therefore the same as to ask that each of its elements is nilpotent.

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{characterization-infinitesimal-variety}
  A pointed affine scheme $(\Spec A, \pi)$
  is an infinitesimal variety
  if and only if,
  for every $x : \Spec A$ we have $\lnot \lnot (x = \pi)$.
\end{lemma}

\begin{proof}
  First note that we can choose a finite presentation
  $A = R[X_1, \dots, X_n]/(r_1, \dots, r_m)$
  of $A$
  such that $\pi(X_i) = 0$ for all $i$
  (see~\cite{david-orbifolds}[Lemma 4.1.3])
  and therefore $\ker \pi = (X_1, \dots, X_n)$.

  Assume $(\Spec A, \pi)$ is an infinitesimal variety.
  By (\axiomref{sqc}), this means that $(A, \pi)$ itself is a Weil algebra,
  so every $X_i$ is nilpotent in $A$.
  Now if $x : \Spec A$ is any homomorphism $A \to R$,
  then $x(X_i)$ is also nilpotent in $R$,
  meaning, by \cref{nilpotence-double-negation}, that $\lnot \lnot (x(X_i) = 0)$.
  Since we have this for all $i = 1, \dots, n$
  and double negation commutes with finite conjunctions,
  we have $\lnot \lnot (x = \pi)$.

  Now assume $\lnot \lnot (x = \pi)$ for all $x : \Spec A$.
  To show that $(A, \pi)$ is a Weil algebra,
  let $f : A$ be given with $\pi(f) = 0$.
  Then in particular we have $\lnot \lnot (x(f) = 0)$
  for every $x : \Spec A$.
  But this means $D(f) = 0$
  (using (\axiomref{loc}) for $\inv(x(f)) \Rightarrow x(f) \neq 0$),
  so $f$ is nilpotent by \cref{standard-open-empty}.
\end{proof}

The following lemma allows us to reduce
maps from infinitesimal varieties to schemes
to the affine case:

\begin{lemma}%
  \label{affine-opens-infinitesimal-closed}
  Let $X$ be a scheme, $V$ an infinitesimal variety and $p:X$.
  Then for all affine open $U\subseteq X$
  containing $p$, there is an equivalence
  of pointed mapping types:
  \[ V\to^. (X, p) \quad\cong\quad V\to^. (U, p) \]
\end{lemma}

\begin{proof}
  By \cref{characterization-infinitesimal-variety},
  all points in $V$ are not not equal,
  so all points in the image of a pointed map
  \[ V \to^. (X, p) \]
  will be not not equal to $p$.
  Since $p \in U$ and open propositions are double-negation stable
  (\cref{open-union-intersection}),
  the image is contained in $U$
  and the map factors uniquely over $(U, p)$.
\end{proof}

\begin{definition}
  Let $X$ be a type and $p:X$ a point in $X$.
  The \notion{tangent space}\index{$T_pX$} of $X$ at $p$, is the type
  \[ T_pX\colonequiv \{d:\D(1)\to X\vert d(0)=p \}\rlap{.}\]
\end{definition}

We transfer a result of Myers \cite{david-orbifolds}[Theorem 4.2.19] to schemes:

\begin{theorem}%
  Let $X$ be a scheme.
  There is a coherent $R$-module structure on the tangent spaces $T_pX$,
  i.e. there is a map
  \[ (p:X)\to \text{is-$R$-module}(T_pX)\rlap{.}\]
\end{theorem}

\begin{proof}
  Following the proof of \cite{david-orbifolds}[Theorem 4.2.19],
  it is enough to show, that any scheme is infinitesimal linear,
  which amount to showing that
  \[
    \begin{tikzcd}
      X^{\D(n+m)}\ar[r]\ar[d] & X^{\D(n)}\ar[d] \\
      X^{\D(m)}\ar[r]         & X
    \end{tikzcd}
  \]
  is a pullback for all $n,m:\N$.
  This is equivalent to:
  For any $p:X$, we have an equivalence of types of pointed maps
  \begin{align*}
    &\D(n+m)\to^.X \\
    = &\left(\D(n)\to^.X\right) \times \left({\D(m)}\to^.X\right).
  \end{align*}
  Let $U=\Spec A$ be an affine open containing $p$.
  By \cref{affine-opens-infinitesimal-closed},
  we only need to show:
  \begin{align*}
    &\D(n+m)\to^.U \\
    = &\left(\D(n)\to^.U\right) \times \left({\D(m)}\to^.U\right).
  \end{align*}
  \emph{tbc}
\end{proof}
