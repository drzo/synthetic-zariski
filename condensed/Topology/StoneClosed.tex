\subsection{The topology on Stone spaces}
\begin{theorem}\label{StoneClosedSubsets}
  Let $A\subseteq S$ be a subset of a Stone space. TFAE:
  \begin{enumerate}[(i)]
    \item There exists a map $\alpha_{(\cdot)}:S \to 2^\N$ such that 
      $A (x) \leftrightarrow \forall_{n:\N} \alpha_x(n) = 0$ for any $x:S$. 
    \item There exists some countable family 
      $D_n,~{n:\N}$ 
      of decidable subsets of $S$ with $A = \bigcap_{n:\N} D_n$. 
    \item There exists a Stone space $T$ and some map $T\to S$ whose image is $A$. 
    \item $A$ is closed.
  \end{enumerate}
\end{theorem}
\begin{proof}
\item 
  \begin{itemize}
  \item[$(i)\leftrightarrow (ii)$.] 
    $D_n$ and $\alpha_{(\cdot)}$ can be defined from each other by 
%    Define the decidable subsets of $S$ 
     $D_n(x) \leftrightarrow (\alpha_x(n) = 0)$. Then observe that %$A=\bigcap_{n:\N} D_n$ as 
     \begin{equation}
      (\bigcap_{n:\N} D_n) (x) \leftrightarrow 
      \forall_{n:\mathbb N} (\alpha_x(n) = 0) 
%      \leftrightarrow A s. 
     \end{equation}
   \item[$(ii) \to (iii)$.]
      Let $S=Sp(B)$. 
      By Stone duality, we have $d_n,~n:\N$ terms of $B$ such that $D_n = \{x:S| x(d_n) = 1\}$. 
      Let $C = B/\langle (\neg d_n)_{n:\N}\rangle$.
      Then the map $Sp(C) \to S$ is as desired because
      $$Sp(C) = \{x:S| \forall_{n:\N} x(\neg d_n) =0\}  = \bigcap_{n:\N} D_n.$$
%      By \Cref{SurjectionsAreFormalSurjections}, t
%      The quotient map $B \twoheadrightarrow C$
%      corresponds to a map $\iota:Sp(C) \hookrightarrow  S$. 
%      For $s:S$, $s$ lies in the image of this map iff 
%      for all $n:\N$ we have  $s(\neg d_n) = 0$, 
%      \begin{equation}
%        x\in \iota(Sp(C)) \leftrightarrow x(\neg d_n) = 0 \leftrightarrow x(d_n) = 1 \leftrightarrow x\in D_n
%      \end{equation}
%      Thus the image of $\iota$ is given by $\bigcap_{n:\N} D_n$. 
   \item[$(iii) \to (i)$.] 
     \rednote{TODO 
       The order of untracating is important in this proof, 
     and I struggle a bit with stressing this in a way this is clear (and concise). 
    Check with fresh eyes later. }
      Let $f:T\to S$ be a map between Stone spaces. 
      Assume $S = Sp(A), T = Sp (B)$. 
%      For this proof, we work with explicit presentations for $A,B$. 
%
      Let $G$ be a countable set of generators of $A$. 
      Assume also we have countable sets of generators and relations for $B$. 
%
      Following \Cref{FiberConstruction}, using $G$, for each $x:S$, we can construct 
      a countable set $I_x\subseteq B$ such that $$Sp(B/I_x) = (\Sigma_{y:T} f(y) = x) .$$
      As we saw in \Cref{BooleEqualityOpen} and \Cref{TruncationStoneClosed}, 
      this type being inhabited is a countable conjunction 
      of decidable propositions on the relations for $B/I_x$. 
      As these relations are explicit, we can construct the sequence $\alpha_x$ as required. 

%
%      Recall that the propositional truncation of a Stone is closed, as it is the negation of $0=1$ in the underlying 
%      Boolean algebra, which is open as it f
%
%
%      the core idea of the proof was that the closed proposition corresponds to checking equality in the underlying BA, 
%      which was closed as 
%
%
%
%
%      Note that $x$ in the image of $f$ iff $0\neq_{B/I_x} 1$. 
%      At this point, we have generators and relations of $B/I_x$ as data.
%      Hence using the proof of \Cref{BooleEqualityOpen}, we can construct a sequence 
%      $\alpha_x:2^\N$ such that $0 =_{B/I_x}1\leftrightarrow \exists_{n:\N} \alpha_x(n) = 0$. 
%      And for $\beta_x(n) = 1-\alpha_x(n)$, we conclude that 
%      \begin{equation}
%        x\in f(T) \leftrightarrow \forall_{n:\N} \beta_x(n) = 0
%      \end{equation}
%      Note that we did not use any choice axioms in the proof of this implication,
%      as we untruncated our assumptions before we specified $x$. 
   \item [$(i) \to (iv)$.] By definition.
   \item[$(iv) \to (iii)$.]
     As $A$ is closed, it induces a map $a:S\to \Closed$. 
     We can cover the closed propositions with Cantor space
     by sending 
     $\alpha \mapsto \forall_{n:\mathbb N} \alpha n = 0.$
     Now local choice gives us that there merely exists $T, e, \beta_\cdot$ as follows:
     \begin{equation}
       \begin{tikzcd}
         T \arrow[r,"\beta_\cdot"] \arrow[d, two heads,"e"] & 2^\mathbb N 
         \arrow[d,two heads, "\forall_{n:\mathbb N} (\cdot)n = 0"] \\
         S \arrow[r,"a"] & \Closed
       \end{tikzcd} 
     \end{equation} 
     Define $B(x) \leftrightarrow \forall_{n:\mathbb N} \beta_x(n) = 0$. 
     As $(i) \to (iii)$ by the above, $B$ is the image of some Stone space. 
     Furthermore, note that $A$ is the image of $B$, thus $A$ is the image of some Stone space. 
\end{itemize} 
\end{proof} 

\begin{lemma}\label{StoneSeperated}
  If $S:\Stone $, and $F,G:S \to \Closed$ be such that $F\cap G = \emptyset$. 
  Then there exists a decidable subset $D:S \to 2$ such $F\subseteq D, G \subseteq \neg D$. 
\end{lemma}
\begin{proof}
  Assume $S = Sp(B)$. 
  By the above theorem, there exists sequences $f_n,g_n:B,~n:\N$ such that 
  $x\in F$ iff $x(f_n) = 1$ for all $n:\N$ and 
  $y\in G$ iff $y(g_m) = 1$ for all $m:\N$. 
%
  Denote $R\subseteq B$ for $\{\neg f_n|n:\N\} \cup\{\neg g_n|n:\N\}$. 
  Note that any inhabitant $Sp(B/R)$ gives a map $x:B\to 2$ such that
  $x(g_n)= x(f_n) = 1$ for all $n:\N$, hence $x\in F \cap G$. 
  As $F\cap G = \emptyset $, it follows that $Sp(B/R)$ is empty.
%
  Thus there exists finite sets $I,J\subseteq \N $ such that 
  $$1 =_B ((\bigvee_{i\in I} \neg f_i) \vee (\bigvee_{j\in J} \neg g_j)).$$
%
  Let $y\in G$. Then $y(\neg g_j) = 0$ for all $j \in J$. 
  Hence 
  $$
  1 = y(1) 
  = 
  y(\bigvee_{i\in I} \neg f_i) = y (\neg (\bigwedge_{i\in I} f_i))
  $$
  Thus $y(\bigwedge_{i\in I} f_i) = 0$. 
  Note that if $x\in F$, we have $x(f_i) = 1$ for all $i\in I$, hence 
  $x(\bigwedge_{i\in I} f_i) = 1$. 
  Thus for $D$ corresponding to $\bigwedge_{i\in I} f_i$, we have that 
  $F\subseteq D, G\subseteq \neg D$ as required. 
\end{proof} 

