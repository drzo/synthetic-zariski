%% The goal of this note is to show that $\Pic(\bP^n) = \Z$ in the setting of Synthetic Algebraic
%% Geometry \cite{draft}. We actually present a strengthening of this result,
%% which in particular states the equivalence
%% $$(\bP^1\to{\KR})\simeq (\Z\times \KR)$$
%% %We will also present Matthias' strengthened version of this statement, which states that the
%% %map $\Z\times \KR\rightarrow {\KR}^{\bP^1},~p,l\mapsto (x\mapsto l\times \OO(p)(x))$
%% %is an equivalence.

%% One application is that $\Aut(\bP^n)$ is $\PGL_{n+1}$.

%% For the case $n=1$,
%% we follow the proof of Horrock's Lemma as presented in Lam's book on Serre's problem \cite{Lam}
%% on projective modules\footnote{This argument is different from the one presented in Lombardi-Quitt\'e \cite{lombardi-quitte}; we instead give a constructive version of the proof of Nashier-Nichols \cite{Nashier}.}.
%% For the general case, we don't follow the Quillen patching technique
%% presented in the 1976 paper \cite{Quillen}, but instead present an argument which uses
%% our description of ${\bP^1}\to{\KR}$.
%% We then explain how we can deduce that $\Aut(\bP^n)$ is $\PGL_{n+1}$.

%%  One point of this work is to show that all these results can be proven axiomatically in the
%%  setting of univalent type theory with the 3 axioms described in \cite{draft}.
%%  ALREADY IN THE INTRODUCTION

 The following result also holds for a general \emph{connected}\footnote{If $e(1-e) = 0$ then $e=0$ or $e=1$.} ring,
 without assuming a finite presentation. 

 \begin{lemma}\label{stand}
   Let $A$ be a connected, finitely presented $R$-algebra, then
   an invertible element of $A[X,1/X]$ can be written $X^N\Sigma a_nX^n$ with $N$ in $\Z$
   and $a_0$ unit and $a_n$ nilpotent if $n\neq 0$.
 \end{lemma}

 \begin{proof}
   Let $P:A[X,1/X]$ be invertible, with inverse $Q:A[X,1/X]$, and $P=\sum_ia_iX^i$ and $Q=\sum_ib_iX^i$.
   By duality we can view the coefficients as functions $a_i,b_i:\Spec(A)\to R$.
   For all $x:\Spec(A)$, we get an invertible $P_x:R[X,1/X]$ by evaluating the coefficients of $P$ at $x$.
   Then $P_x\cdot Q_x=1$ and in particular $1=\sum_{i+j=0}a_ib_j$, so by locality of $R$, we have $i$ such that $a_i$ is invertible.
   Without loss of generality, we assume $i=0$ and want to show $\neg\neg (a_j=0)$ for $j\neq 0$.
   Since we prove a negated proposition, we can assume that we have $l,k$ minimal with $a_l$ and $b_k$ invertible.
   Then we must have $k+l=0$ because we would have $0=a_lb_k$ otherwise.
   $k$ was minimal, so it is $0$ and $l$ is $0$ as well.
   The same reasoning applies for a maximal choice of $k$.
 \end{proof}
 
 Using this Lemma we deduce the following.

\begin{lemma}\label{nilpotent}
  Any invertible element of $A[X,1/X]$ can be written uniquely as a product
  $uX^l(1+a)(1+b)$ with $l$ in $\Z$, $u$ in $A^{\times}$ and $a$ (resp. $b$)
  polynomial in $A[X]$ (resp. $1/XA[1/X]$) with only nilpotent coefficients.
\end{lemma}

\begin{proof}
  Write $\Sigma v_nX^n$ the invertible element of $A[X,1/X]$.
  W.l.o.g. we can assume that the polynomial is of the form $1 + \Sigma v_nX^n$ with
  all $v_n,~n\in \Z$ nilpotent.
  We let $J$ be the ideal generated by these nilpotent elements.
  We have some $N$ such that $J^N = 0$.
  
  We first multiply by the inverse of $1 + \Sigma_{n<0}v_nX^n$, making all coefficients of
  $X^n,~n<0$ in $J^2$.
  We keep doing this until all these elements are $0$.
  %We then do the same, killing all coefficients of $X^n$ for $n>0$.
  We have then written the invertible polynomials on the form $(1+a)(1+b)$.

  Such a decomposition is unique: if we have $(1+a)(1+b)$ in $A^{\times}$ with $a = \Sigma_{n\geqslant 0}a_nX^n$
  and $b = \Sigma_{n<0}b_nX^n$ then we have $a_n = 0$ for $n>0$ and $b_n = 0$ for $n<0$.
\end{proof}

\begin{corollary}\label{Pic1}
  We have $\prod_{L:\bP^1\rightarrow \KR}\Sigma_{p:\Z}\|L = \OO(p)\|$
\end{corollary}

\begin{proof}
A line bundle $L([x_0,x_1])$ on $\bP^1$ is trivial on each of the affine charts $x_0\neq 0$ and $x_1\neq 0$ by Corollary \ref{c1}, so
it is characterised by an invertible Laurent polynomial on $R$, and the result follows from Lemma \ref{nilpotent}.
\end{proof}

We can then state the following strengthening.

\begin{proposition}\label{Matthias}
  The map $\KR\times\Z\rightarrow (\bP^1\rightarrow \KR)$
  which associates to $(l_0,d)$ the map $x\mapsto l_0\otimes \OO(d)(x)$ is an equivalence.
\end{proposition}

\begin{proof}
  Corollary \ref{Pic1} shows that this map is essentially surjective.
  So we can conclude by showing that the map is also an embedding.
  For $(l,d),(l',d'):\KR\times\Z$ let us first consider the case $d=d'$. 
  Then we merely have $(l,d)=(\ast,d)$ and $(l',d')=(\ast,d)$,
  so it is enough to note that the induced map on loop spaces based at $(\ast,d)$ is an equivalence by \Cref{const}.
  Now let $d\neq d'$. To conclude we have to show $\OO(k)$ is different from $\OO(0)$ for $k\neq 0$.
  It is enough to show that for $k>0$ the bundle $\OO(k)$ has at least two linear independent sections,
  since we know $\OO(0)$ only has constant sections by \Cref{const}.
  This follows from the fact that $\OO(k)(x)$ is $\Hom_{\Mod{R}}(Rx^{\otimes k},R)$ and has all projections as sections.
  %% which we can naturally identify with $\Hom_{\Mod{R}}(R(x_0^k,x_1^k),R)$ for $x=(x_0,x_1)$.
  %% Then $s_0(r\cdot (x_0^k,x_1^k))\colonequiv r\cdot x_o^k$ and $s_1(r\cdot (x_0^k,x_1^k))\colonequiv r\cdot x_1^k$ define two sections
  %% which are independent since $s_0([0:1])=0\neq s_1([0:1])$ and $s_1([1:0])=0\neq s_1([1:0])$.
  %TC: I think it is clearer not so say too much here. 
\end{proof}

 It is a curious remark that $\KR\rightarrow \KR$ is also equivalent
 to $\KR\times \Hom_{\mathrm{Group}}(R^\times,R^\times) = \KR\times\Z$.

\begin{corollary}\label{Matthias1}
  We have $\prod_{L:\bP^1\rightarrow \KR}\prod_{x:R}L([1:x]) = L([0:1])$.
\end{corollary}

\begin{proof}
  By the equivalence in \Cref{Matthias}, we have
  \[ \prod_{L:\bP^1\to \KR} \,\prod_{x : \bP^1}  L(x)=l_0\otimes \OO(d)(x) \]
  for some $(l_0,d)$ corresponding to $L$.
  $\OO(d)([0:1])$ can be identified with $R^1$ and $\OO(d)$ is trivial on $R$,
  so we have $L([1:x])=l_0=L([0:1])$ for all $x:R$.
\end{proof}

\section{Line bundles on $\bP^n$}
We will prove $\Pic(\bP^n)=\Z$ and a strengthening thereof in this section by mostly algebraic means.
In \Cref{geometric-proof} we will give a shorter geometric proof.

We can now reformulate Quillen's argument for Theorem 2' \cite{Quillen} in our setting.

\begin{proposition}\label{trivial}
  For all $V:\bP^n\rightarrow \KR$ we have ${\prod_{s:R^n}V([1:s]) = V([0:1:0:\cdots :0])}$.
\end{proposition}

\begin{proof}
  We define $L:R^{n-1}\rightarrow (\bP^1 \to \KR)$ by $L~t~[x_0:x_1] = V([x_0:x_1:x_0t])$.
  Let $s=(s_1,\dots,s_{n}):R^{n}$. We apply Corollary \ref{Matthias1} and we get
  \[
   V([1:s]) = L~(s_2,\dots,s_n)~[1:s_1] = L~(s_2,\dots,s_n)~[0:1] = V([0:1:0:\cdots :0])
   \rlap{.}
  \]
\end{proof}

 Note that the use of Corollary \ref{Matthias1} replaces the use of the ``Quillen patching''
 \cite{lombardi-quitte} introduced in \cite{Quillen}.

\medskip

Let $T$ be the ring of polynomials $u = \Sigma_p u(p)X^p$ with
$X^p = X_0^{p_0}\dots X_n^{p_n}$ with $\Sigma p_i = 0$. We write $T_l$ for the subring
of $T$ which contains only monomials $X^p$ with $p_i\geqslant 0$ if $i\neq l$
and $T_{lm}$ the subring of $T$ 
which contains only monomials $X^p$ with $p_i\geqslant 0$ if $i\neq l$ and $i\neq m$.

Note that $T_l$ is the polynomial ring $T_l = R[X_0/X_l,\dots,X_n/X_l]$.

A line bundle on $\bP^n$ is given by compatible line bundles on each $\Spec(T_l)$.

By \Cref{trivial}, a line bundle on $\bP^n$ is trivial on each $\Spec(T_l)$.
So it is determined by $t_{ij}$ invertible in $T_i[X_i/X_j] = T_j[X_j/X_i] = T_{ij}$
such that $t_{ik} = t_{ij}t_{jk}$ and $t_{ii} = 1$. 
Using \Cref{stand} we can assume without loss of generality, that
$t_{ij} = (X_i/X_j)^{N_{ij}} u_{ij}$, for some $N_{ij}$ in $\Z$, where $u_{ij}(p)$ is invertible for $p = 0$
and all other coefficients $u_{ij}(p)$ for $p\neq 0$
are nilpotent. By looking at the relation  $t_{ik} = t_{ij}t_{jk}$ when we quotient by nilpotent elements, we see that
$N_{ij} = N$ does not depend on $i,j$.
The result $\Pic(\bP^n) = \Z$ will then follow from the following result.

\begin{proposition}
  There exists $s_i$ invertible in $T_i$ such that $u_{ij} = s_i/s_j$ 
\end{proposition}

\begin{proof}
%  (We follow essentially David's argument.)
  Each $u_{ij}$ is such that $u_{ij}(p)$ unit for $p=0$ and
  all $u_{ij}(p)$ nilpotent for $p\neq 0$.

  Like in the proof of \Cref{nilpotent}, we can change $u_{01}$ so that
  we have $u_{01}(p) = 0$ if $p\neq 0$ and $p_0\geqslant 0$ or $p_1\geqslant 0$ by multiplying $u_{01}$ by a unit in $T_0$ and
  a unit in $T_1$. Let us show for instance how to force $u_{01}(p) = 0$ if $p\neq 0$ and $p_1\geqslant 0$ by multiplying $u_{01}$
  by a unit in $T_0$. Let $M$ be the ideal generated by $u_{01}(p)$ for $p\neq 0$, which is a nilpotent ideal. If we
  multiply $u_{01}$ by $u_{01}(0) - \Sigma_{p_1\geqslant 0} u_{01}(p)$
  we change $u_{01}$ to $u'_{01}$ where all $u_{01}'(p)$, for $p_1\geqslant 0$ and $p\neq 0$, are in $M^2$. We iterate this process
  and since $M$ is nilpotent, we force $u_{01}(p) = 0$ or $p\neq 0$ and $p_1\geqslant 0$.

  We can thus assume that $u_{01}(p) = 0$ if $p\neq 0$ and $p_0\geqslant 0$ or $p_1\geqslant 0$.
  
  We claim then that, in this case, $u_{01}$ has to be a unit. For this we show that $u_{01}(p) = 0$
  if $p_l>0$ for each $l\neq 0,1$. 
  This is obtained by looking at the relation $u_{01}= u_{0l}u_{l1}$. Let $L$ be the ideal generated by
  coefficients $u_{0l}(p)$ and $u_{1l}(p)$ with $p_l>0$ and $I$
  the ideal generated by all nilpotent coefficients of $u_{0l}$ and $u_{l1}$.
  Thanks to the form of $u_{01}$ we must have $L\subseteq LI$ and so $L=0$ by Nakayama. Indeed we have
  $$u_{01}(p) = u_{0l}(p)u_{l1}(0) + u_{0l}(0)u_{l1}(p) + \Sigma_{q+r = p, q\neq 0, r\neq 0}u_{0l}(q)u_{l1}(r)$$
  and we use this to show that $u_{0l}(p)$ is in $LI$.
  Since $p_l>0$, we have $u_{0l}(p) = 0$ if $p_0\geqslant 0$, hence we can assume $p_0<0$.
  We also have $u_{0l}(p)$ if $p_1<0$ and we can assume $p_1\geqslant 0$.
  This implies $u_{l1}(p) = 0$ (since $p_0<0$) and $u_{01}(p) = 0$ (since $p_0<0$ and $0\leqslant p_1$).
  We get thus
  $$u_{0l}(p)u_{l1}(0) = - \Sigma_{q+r = p, q\neq 0, r\neq 0}u_{0l}(q)u_{l1}(r)$$
  and each member in the sum $u_{0l}(q)u_{l1}(r)$ is in $IL$ since $q_l+r_l = p_l>0$ and hence $q_l>0$ or $r_l>0$.

  We thus deduce $L=0$ by Nakayama. We get, for $p_l>0$
  $$u_{01}(p) = u_{0l}(p)u_{l1}(0) + u_{0l}(0)u_{l1}(p)$$
  and if $p_0<0$ and $p_1<0$ we have $u_{0l}(p) = u_{l1}(p) = 0$.

  This implies that all coefficients $u_{01}(p)$ such that $p_l>0$ are $0$.

  Since this holds for each $l>1$ we have that $u_{01}$ is a unit in $R$.

  W.l.o.g. we can assume $u_{01}= 1$. We then have $u_{0l} = u_{1l}$ in $T_{0l}\cap T_{1l} = T_l$
  and we take $s_l = u_{0l} = u_{1l}$.
\end{proof}

\begin{corollary}
  $\Pic(\bP^n) = \Z$.
\end{corollary}

We can then strengthen this result, with the same reasoning as in Proposition \ref{Matthias}.

\begin{theorem}\label{Matthias2}
  The map $\KR\times\Z\rightarrow (\bP^n\rightarrow \KR)$
  which associates to $l_0,d$ the map $x\mapsto l_0\otimes \OO(d)(x)$ is an equivalence.
\end{theorem}

We deduce from this a characterisation of the maps $\bP^n\rightarrow\bP^m$.% using Lemma \ref{hom}.

\begin{corollary}\label{map}
  A map $\bP^n\rightarrow\bP^m$ is given by $m+1$ homogeneous polynomials $p = (p_0,\dots,p_m)$ on $R^{n+1}$
  of the same   degree $d$ such that $x\neq 0$ implies $p(x)\neq 0$.
\end{corollary}

\begin{proof}
Write $T_n(l)$ for $l^{n+1}\setminus\{0\}$. We have $\bP^n = \Sigma_{l:\KR}T_n(l)$ and so
$$
\bP^n\rightarrow\bP^m = \sum_{s:\bP^n\rightarrow \KR}\prod_{x:\bP^n}T_m(s~x)
$$
Using Theorem \ref{Matthias2}, this is equal to
$$
\sum_{l_0:\KR}\sum_{d:\Z}\prod_{l:\KR}T_n(l)\rightarrow T_m(l_0\otimes l^{\otimes d})
$$
and, as for Lemma \ref{hom}, this is the set of tuples of $m+1$ polynomials in $R[X_0,\dots,X_n]$ homogenenous
of degree $d$, sending $x\neq 0$ to $p(x)\neq 0$, and quotiented by proportionality.
\end{proof}

We deduce the characterisation of $\Aut(\bP^n)$. This is a
remarkable result, since the automorphisms are in this framework only bijections of sets.

\begin{corollary}
  $\Aut(\bP^n)$ is $\PGL_{n+1}$.
\end{corollary}

We also have the following application of computation of cohomology groups \cite{draft}.

\begin{corollary}
A function $\bP^n\rightarrow\bP^m$ is constant if $n>m$.
\end{corollary}

\begin{proof}
We proved in \cite{cech-draft} that cohomology groups can be computed as Cech cohomology for any
finite open acyclic covering and used this to prove $H^n(\bP^n,\OO(-n-1))=R$.
By \Cref{map}, a map $\bP^n\rightarrow\bP^m$ is given by $m+1$ non zero polynomials
$p(x) = (p_0(x),\dots,p_m(x))$ homogeneous of the same degree $d\geqslant 0$ and such that $x\neq 0$ implies $p(x)\neq 0$.
This means that $\bP^n$ is covered by $m+1$ open subsets $U_i(x)$ defined by $p_i(x)\neq 0$.
I claim that we should have $d=0$.

 If $q(x)$ is a non zero homogeneous polynomial of degree $d>0$, the open $q(x)\neq 0$ defines an {\em affine}
 and hence acyclic \cite{cech-draft}, open subset of $\bP^n$ (see e.g. Exercise 3.5 in \cite{Hartshorne}).
 It follows that the covering $U_0,\dots,U_m$ is acyclic if $d>0$. But this contradicts $H^n(\bP^n,\OO(-n-1))=R$.

 Hence $d=0$ and the map is constant.
\end{proof}
