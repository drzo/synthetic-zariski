In non-synthetic algebraic geometry,
the structure sheaf~$\mathcal{O}_X$ is part of the data constituting a scheme~$X$.
In our internal setting,
the scheme $X$ is just a set without any additional data,
but when we want to consider the structure sheaf as an object in its own right,
then we can represent it by the trivial bundle
that assings to every point $x : X$ the set $R$.
Indeed, for an affine scheme $X = \Spec A$,
taking the sections of this bundle over a basic open $D(f) \subseteq X$
\[ \prod_{x : D(f)} R = (D(f) \to R) = A[f^{-1}] \]
yields the localizations of the ring $A$
expected from the structure sheaf $\mathcal{O}_X$.
More generally,
instead of sheaves of abelian groups, $\mathcal{O}_X$-modules, etc.,
we will consider bundels of abelian groups, $R$-modules, etc.,
in the form of maps from $X$ to the respective type of algebraic structures.

\subsection{Finitely presented bundles}

We now investigate the relationship between bundles of $R$-modules on $X = \Spec A$
and $A$-modules.

\begin{proposition}
  Let $A$ be a finitely presented $R$-algebra.
  There is an adjunction
  \[ \begin{tikzcd}[row sep=tiny]
    M \ar[r, mapsto] & {(M \otimes x)}_{x : \Spec A} \\
    \Mod{A} \ar[r, shift left=2] \ar[r, phantom, "\rotatebox{90}{$\vdash$}"] &
    \Mod{R}^{\Spec A} \ar[l, shift left=2] \\
    \prod_{x : \Spec A} N_x & N \ar[l, mapsto]
  \end{tikzcd} \]
  between the category of $A$-modules
  and the category of bundles of $R$-modules on $\Spec A$.
\end{proposition}

\begin{theorem}%
  \label{fp-module}
  Let $X=\Spec(A)$ be affine and
  let a bundle of finitely presented $R$-modules $M : X\to \fpMod{R}$ be given.
  Then the $A$-module
  \[ \tilde{M}\coloneqq\prod_{x:X}M_x \]
  is finitely presented and for any $x:X$ the $R$-module $\tilde{M}\otimes_A R$ is $M_x$.
  Under this correspondence, localizing $\tilde{M}$ at $f:A$ corresponds to restricting $M$ to $D(f)$.
\end{theorem}

\subsection{Cohomology on affine schemes}

\begin{definition}
  Let $X$ be a type and $A:X\to \AbGroup$ a map to the type of abelian groups.
  For $x:X$ let $T_x$ be a set with an $A_x$ action.
  \begin{enumerate}[(a)]
  \item $T$ is an \notion{$A$-pseudotorsor}, if the action is free and transitive for all $x:X$.
  \item $T$ is an \notion{$A$-torsor}, if it is an $A$-pseudotorsor and
    \[ \prod_{x:X} \| T_x \| \rlap{.}\]
  \item We write $\Tors{A}(X)$ for the type of $A$-torsors on $X$.
  \end{enumerate}
\end{definition}

Torsors are a concrete implementaion of first deloopings:

\begin{definition}
  \label{delooping}
  Let $n:\N$.
  A $n$-th \notion{delooping}\index{$K(A,n)$} of an abelian group $A$,
  is a pointed, $(n-1)$-connected, $n$-truncated type $K(A,n)$,
  such that $\Omega^nK(A,n)=_{\AbGroup}A$.
\end{definition}

For any abelian group and any $n$, a delooping $K(A,n)$ exists by \cite{licata-finster}.
Deloopings can be used to represent cohomology groups by mapping spaces.
This is usually done in homotopy type theory to study higher inductive types, such as spheres and CW-complexes,
but the same approach works for internally representing sheaf cohomology,
which is the intent of the following definition:

\begin{definition}
  \label{cohomology}
  Let $X$ be a type and $\mathcal F:X\to\AbGroup$ a dependent abelian group.
  The $k$-th cohomology group of $X$ with coefficients in $\mathcal F$ is
  \[
    H^k(X,\mathcal F)\colonequiv \left\|\prod_{x:X}K(\mathcal F,k)\right\|_0\rlap{.}
  \]
\end{definition}


The following is an explicit formulation of the fact, that the Čech-Complex for an
$\mathcal{O}_X$-module sheaf on $X=\Spec(A)$ given by an $A$-module $M$ is exact in degree 1.
\begin{lemma}%
  \label{H1-algebra}
  Let $M$ be a module over a commutative ring $A$, $F_1,\dots,F_l$ a coprime system on $A$
  and for $i,j\in\{1,\dots,l\}$, let $s_{ij} : F_i^{-1} F_j^{-1} M$ such that:
  \[ s_{jk}-s_{ik}+s_{ij}=0 \rlap{.}\]
  Then there are $u_i:F_i^{-1}M$ such that $s_{ij}=u_j - u_i$.
\end{lemma}

\begin{proof}
  Let $s_{ij}=\frac{m_{ij}}{f_i f_j}$ with $m_{ij}:M$, $f_i:F_i$ and $f_j:F_j$ such that:
  \[ f_i\cdot m_{jk}-f_j\cdot m_{ik}+f_k\cdot m_{ij}=0 \rlap{.}\]
  Let $r_i$ such that $\sum r_i f_i =1$.
  Then for
  \[ u_i \coloneqq -\sum_{k=1}^l\frac{r_k}{f_i}m_{ik} \]
  we have:
  \begin{align*}
      u_j-u_i &= -\sum_{k=1}^l\frac{r_k}{f_j}m_{jk} + \sum_{k=1}^l\frac{r_k}{f_i}m_{ik} \\
              &= -\sum_{k=1}^l\frac{r_k}{f_j f_i}f_i m_{jk} + \sum_{k=1}^l\frac{r_k}{f_i f_j} f_j m_{ik} \\
              &= \sum_{k=1}^l\frac{r_k}{f_j f_i}(-f_i m_{jk} + f_j m_{ik}) \\
              &= \sum_{k=1}^l\frac{r_k}{f_j f_i}f_k m_{ij} \\
              &= \frac{m_{ij}}{f_i f_j}
  \end{align*}
  \ %
\end{proof}

\begin{theorem}[using \axiomref{Z-choice}]%
  \label{H1-fp-module-affine-trivial}
  For any affine scheme $X=\Spec(A)$ and coefficients $M: X\to \fpMod{R}$, we have
  \[ H^1(X,M)=0 \rlap{.} \]
\end{theorem}
\begin{proof}
  We need to show, that any $M$-torsor $T$ on $X$ is merely equal to the trivial torsor $M$,
  or equivalently show the existence of a section of $T$.
  We have
  \[ \prod_{x:X}\| T_x \|\]
  and therefore, by (\axiomref{Z-choice}),
  there merely are $f_1,\dots,f_l:A$,
  such that the $U_i\coloneqq \Spec(A_{f_i})$ cover $X$ and
  there are local sections
  \[ s_i:\prod_{x:U_i}T_x\]
  of $T$. Our goal is to construct a matching family from the $s_i$.
  On intersections, let $t_{ij}\coloneqq s_i-s_j$ be the difference, so $t_{ij}:(x : U_i\cap U_j) \to M_x$.
  By \cref{fp-module} equivalently, we have $t_{ij}:\tilde{M}_{f_i f_j}$.
  Since the $t_{ij}$ were defined as differences,
  the condition in \cref{H1-algebra} is satisfied and we get
  $u_i:\tilde{M}_{f_i}$, such that $t_{ij}=u_i-u_j$.
  So we merely have a matching family $\tilde{s}_i\coloneqq s_i-u_i$ and therefore, using Lemma \ref{kraus-glueing} merely a section of $T$.
\end{proof}

\subsection{Čech-Cohomology}

In this section, let $X$ be a type, $U_1,\dots,U_n\subseteq X$ open subtypes that cover $X$
and $\mathcal F:X\to \AbGroup$ a dependent abelien group on $X$.
We start by repeating the classical definition of Chech-Cohomology groups for a given cover.

\begin{definition}%
  \label{chech-complex}
  \begin{enumerate}[(a)]
  \item \index{$\mathcal F(U)$} For open $U\subseteq X$, we use the notation
    \[
      \mathcal F(U)\colonequiv \prod_{x:U}\mathcal F_x\rlap{.}
    \]
  \item For $s:\mathcal F(U)$ and open $V\subseteq U$ we use the notation $s\colonequiv s_{|V} \colonequiv (x:V)\mapsto s_x$.
  \item \index{$U_{i_1\dots i_l}$}For a selection of indices $i_1,...,i_l:\{1,\dots,n\}$, we use the notation
    \[
      U_{i_1\dots i_l}\colonequiv U_{i_1}\cap\dots\cap U_{i_l}\rlap{.}
    \]
  \item For a list of indices $i_1,\dots,i_l$, let $i_1,\dots,\hat{i_t},\dots,i_l$ be the same list with the $t$-th element removed.
  \item For $k:\Z$, the $k$-th \notion{Čech-boundary operator}\index{$\partial^k$} is the homomorphism
    \[
      \partial^k:\bigoplus_{i_0,\dots,i_k}\mathcal F(U_{i_0\dots i_k})\to \bigoplus_{i_0,\dots,i_{k+1}}\mathcal F(U_{i_0\dots i_{k+1}})
    \]
    given by $\partial^k(s)\colonequiv (l_0,\dots,l_{k+1}) \mapsto \sum_{j=0}^k (-1)^j s_{l_0,\dots,\hat{l_j},\dots,l_k|U_{l_0,\dots,l_{k+1}}}$.
  \item The $k$-th \notion{Čech-Cohomology group} for the cover $U_1,\dots,U_n$ with coefficients in $\mathcal F$ is
    \[
      \check{H}^k(\{U\},\mathcal F)\colonequiv \ker\partial^{k} / \im(\partial^{k-1})\rlap{.}
    \]
  \end{enumerate}
\end{definition}

\begin{definition}
  The cover $U_1,\dots,U_n$ is called \notion{acyclic} for $\mathcal F$,
  if for all $k:\N$ and $i_0,\dots,i_k$, we have that the higher (non Čech) cohomology groups are trivial:
  \[
    \forall l>0. H^l(U_{i_0,\dots,i_k},\mathcal F)=0\rlap{.}
  \]
\end{definition}

\begin{example}
  If $X$ is a scheme, $U_1,\dots,U_n$ a cover by affine open subtypes and $\mathcal F$ pointwise a finitely presented $R$-module,
  then $U_1,\dots,U_n$ is acyclic for $\mathcal F$ by \cref{H1-fp-module-affine-trivial}.
\end{example}

\begin{theorem}[using \axiomref{Z-choice}]%
  If $U_1,\dots,U_n$ is an acyclic cover for $\mathcal F$, then
  \[
    \check{H}^1(\{U\},\mathcal F)=H^1(X,\mathcal F)\rlap{.}
  \]
\end{theorem}

\begin{proof}
  Let $\pi$ be the projection map
  \[
    \pi :
    \left(
      \sum_{T:\Tors{\mathcal F}(X)}\prod_{i}\prod_{x:U_i}T_x
    \right)
    \to \Tors{\mathcal F}(X)\rlap{.}
  \]
  Let us abbreviate the left hand side with $T(\mathcal F,U)$.
  Since the cover is acyclic, $\pi$ is surjective.
  There is a map $\iota$ into the kernel of $\partial^1$ (\cref{chech-complex} (e)):
  \[
    \iota \colonequiv
    (T,t) \mapsto (i,j\mapsto t_i - t_j) :
    T(\mathcal F,U)
    \to
    \ker(\partial^1)
    \subseteq
    \bigoplus_{i,j}\mathcal F(U_{ij})\rlap{.}
  \]
  We will now show, that $\iota$ is an embedding and therefore also, that its domain is a set.
  Let $(T,t),(T',t'):T(\mathcal F,U)$ such that $\iota((T,t))=\iota((T',t'))$,
  i.e. for all $i,j$ we have $t_i-t_j=t'_i-t'_j$.
  The latter shows the well-definedness (needed to apply \cref{kraus-glueing})
  of a global map $T\simeq T'$, given by sending $t_i(x)$ to $t'_i(x)$
  for all $i$ and $x$.

  The map $\iota$ is also a surjection and therefore an isomorphism:
  Let $s:\ker(\partial^1)$.
  Then we can contruct a torsor,
  by starting with the trivial torsor on each $U_i$.
  We use \cref{kraus-glueing-1-type} to get a torsor
  with the identification given by the $s_{ij}$
  where the cocycle condition holds because $s$ is in the kernel.

  Realizing, that $\im(\partial^0)$ corresponds to the subtype of $T(\mathcal F,U)$ of trivial torsors,
  we arrive at the following diagram:
  \begin{center}
    \begin{tikzcd}
      & \Tors{\mathcal F}(X)\ar[r,->>] & H^1(X,\mathcal F) \\
      \sum_{T:T(\mathcal F,U)}\|\pi_1(T)=\mathcal F\|\ar[r,hook] & T(\mathcal F,U)\ar[u,->>]\ar[d,equal] & \\
      \im{\partial^0}\ar[r,hook]\ar[u,equal] & \ker{\partial^1}\ar[r,->>] & \check{H}^1(\{U\},\mathcal F)
    \end{tikzcd}
  \end{center}
  By \cref{MISSING},
  the composed map $T(\mathcal F,U)\to H^1(X,\mathcal F)$ is a homomorphism
  and therefore by \cref{surjective-abgroup-hom-is-cokernel} a cokernel.
  So the two cohomology groups are equal, since they are cokernels of the same diagram.
\end{proof}