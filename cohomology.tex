In non-synthetic algebraic geometry,
the structure sheaf~$\mathcal{O}_X$ is part of the data constituting a scheme~$X$.
In our internal setting,
the scheme $X$ is just a set without any additional data,
but when we want to consider the structure sheaf as an object in its own right,
then we can represent it by the trivial bundle
that assings to every point $x : X$ the set $R$.
Indeed, for an affine scheme $X = \Spec A$,
taking the sections of this bundle over a basic open $D(f) \subseteq X$
\[ \prod_{x : D(f)} R = (D(f) \to R) = A[f^{-1}] \]
yields the localizations of the ring $A$
expected from the structure sheaf $\mathcal{O}_X$.
More generally,
instead of sheaves of abelian groups, $\mathcal{O}_X$-modules, etc.,
we will consider bundels of abelian groups, $R$-modules, etc.,
in the form of maps from $X$ to the respective type of algebraic structures.

\subsection{Line bundles}

\begin{definition}%
  Let $X$ be a type.
  A \notion{line bundle} is a map $\mathcal L : X\to \Mod{R}$,
  such that
  \[ \prod_{x:X} \propTrunc{\mathcal L_x=_{\Mod{R}}R} \rlap{.}\]
  The \notion{trivial line bundle} on $X$ is the line bundle
  $X \to \Mod{R}, x \mapsto R$,
  and when we say that a line bundle $\mathcal{L}$ is trivial
  we mean that $\mathcal{L}$ is equal to the trivial line bundle,
  or equivalently $\propTrunc{\prod_{x:X} \mathcal L_x=_{\Mod{R}}R}$.
\end{definition}

\begin{theorem}
  Every line bundle on $\A^1$ is not not trivial.
\end{theorem}

\begin{proof}
  \dots
\end{proof}

In classical algebraic geometry,
there is the concept of a \notion{generic section} of a line bundle.
Informally, the generic sections have the smallest possible vanishing set.
The following definition is corresponds to this notion:

\begin{definition}%
  \label{def:regular-section}
  Let $X$ be a type and $\mathcal L:X\to \Mod{R}$ a line bundle.
  A section
  \[ s:\prod_{x:X}\mathcal L_x \]
  is \notion{regular}, there merely is a trivializing affine cover $U_1=\Spec A_1,\dots,U_n=\Spec A_n$
  of $\mathcal L$, such that each trivialized restriction
  \[ s_i:\Spec A_i\to R \]
  is a regular element (\cref{def:regular-element}) of $(\Spec A_i\to R) = A_i$.
\end{definition}

\begin{lemma}%
  \label{lem:regular-zariski-local}
  Let $s:\Spec A\to R$.
  $s$ being regular is Zariski-local, i.e.
  for all Zariski-covers $U_1,\dots,U_n$ of $\Spec A$,
  $s$ is regular, if and only if it is regular on all $U_i$.
\end{lemma}

\begin{proof}
  It is enough to check this for a localization at $f:A$.
  Let
  \[ \frac{s}{1}\cdot\frac{g}{f^k}=0\rlap{.} \]
  then $f^lsg=0$, which implies $f^lg=0$ by regularity of $s$ and therefore $\frac{g}{f^l}=0$.
\end{proof}

\begin{proposition}%
  The choice of trivializing cover in \cref{def:regular-section}
  is irrelevant.
\end{proposition}

\begin{proof}
  By \cref{lem:regular-zariski-local}.
\end{proof}

From a line bundle together with a regular section,
we can produce a closed subtype of a special kind:

\begin{definition}%
  Let $X$ be a scheme.
  A \notion{regular closed subtype} of $X$ is a closed subtype
  $C:X\to \Prop$, such that there merely is an affine open cover $U_1=\Spec A_1,\dots,U_n=\Spec A_n$,
  and $C\cap U_i$ is $V(f_i)$ for a regular $f_i:A_i$.
\end{definition}

\begin{lemma}%
  Let $f,g:A$, $f$ be regular and $V(f)=V(g)$,
  then $g$ is regular and there is a unique unit $\alpha:A^\times$, such that $\alpha f=g$.
\end{lemma}

\begin{proof}
  $V(f)=V(g)$ implies there are $\alpha,\beta:A$ such that
  $\alpha f = g$ and $\beta g = f$.
  But then: $f=\beta g=\beta\alpha f$.
  So by regularity of $f$, $\beta\alpha=1$.
  By \cref{lem:units-products-regular}, units are regular and products of regular elements are regular,
  so $g$ is regular.
  Uniqueness of $\alpha$ follows from regularity.
\end{proof}

\begin{theorem}[using \axiomref{Z-choice}]%
  Let $X$ be a scheme.
  For any regular closed subscheme $C$,
  there is a line bundle with regular section $(\mathcal L,s)$ on $X$,
  such that $C=V(s)$.
\end{theorem}

\begin{proof}
  Let $U_1=\Spec A_1,\dots,U_n=\Spec A_n$ be a cover by standard  affine opens such that we have
  regular $f_i$ with $C\cap U_i=V(f_i)$. 
  We define $\mathcal L$ to be the trivial line bundle $\_\mapsto R$ on each $U_i$
  and by giving automorphisms on the intersections $U_i\cap U_j\colonequiv U_{ij}=\Spec A_{ij}$.
  On $U_{ij}$, $C$ is given by $V(\frac{f_i}{1})$ and $V(\frac{f_j}{1})$ which are both regular.
  Therefore, there is a unit $\alpha:A_{ij}^\times$ such that $\alpha\frac{f_i}{1}=\frac{f_j}{1}$,
  which we can also view as a map $U_{ij}\to R^\times$ and since $R^\times$
  is equivalent to the automorphism group of $R$ as an $R$-module,
  this provides the identetification we need to construct $\mathcal L$.
  Under the identification, the local regular sections are identified, so we get a global section $s$ of $\mathcal L$,
  which is locally regular.
\end{proof}

\subsection{Finitely presented bundles}

We now investigate the relationship between bundles of $R$-modules on $X = \Spec A$
and $A$-modules.

\begin{proposition}
  Let $A$ be a finitely presented $R$-algebra.
  There is an adjunction
  \[ \begin{tikzcd}[row sep=tiny]
    M \ar[r, mapsto] & {(M \otimes x)}_{x : \Spec A} \\
    \Mod{A} \ar[r, shift left=2] \ar[r, phantom, "\rotatebox{90}{$\vdash$}"] &
    \Mod{R}^{\Spec A} \ar[l, shift left=2] \\
    \prod_{x : \Spec A} N_x & N \ar[l, mapsto]
  \end{tikzcd} \]
  between the category of $A$-modules
  and the category of bundles of $R$-modules on $\Spec A$.
\end{proposition}

\begin{theorem}%
  \label{thm:fp-module}
  Let $X=\Spec(A)$ be affine and
  let a bundle of finitely presented $R$-modules $M : X\to \fpMod{R}$ be given.
  Then the $A$-module
  \[ \tilde{M}\coloneqq\prod_{x:X}M_x \]
  is finitely presented and for any $x:X$ the $R$-module $\tilde{M}\otimes_A R$ is $M_x$.
  Under this correspondence, localizing $\tilde{M}$ at $f:A$ corresponds to restricting $M$ to $D(f)$.
\end{theorem}

\subsection{Cohomology on affine schemes}

\begin{definition}
  Let $X$ be a type and $A:X\to \AbGroup$ a map to the type of abelian groups.
  For $x:X$ let $T_x$ be a set with an $A_x$ action.
  \begin{enumerate}
  \item $T$ is an \notion{$A$-pseudotorsor}, if the action is free and transitive for all $x:X$.
  \item $T$ is an \notion{$A$-torsor}, if it is an $A$-pseudotorsor and
    \[ \prod_{x:X} \| T_x \| \rlap{.}\]
  \end{enumerate}
\end{definition}

The following is an explicit formulation of the fact, that the ÄŒech-Complex for an
$\mathcal{O}_X$-module sheaf on $X=\Spec(A)$ given by an $A$-module $M$ is exact in degree 1.
\begin{lemma}%
  \label{lem:H1-algebra}
  Let $M$ be a module over a commutative ring $A$, $F_1,\dots,F_l$ a coprime system on $A$
  and for $i,j\in\{1,\dots,l\}$, let $s_{ij} : F_i^{-1} F_j^{-1} M$ such that:
  \[ s_{jk}-s_{ik}+s_{ij}=0 \rlap{.}\]
  Then there are $u_i:F_i^{-1}M$ such that $s_{ij}=u_j - u_i$.
\end{lemma}

\begin{proof}
  Let $s_{ij}=\frac{m_{ij}}{f_i f_j}$ with $m_{ij}:M$, $f_i:F_i$ and $f_j:F_j$ such that:
  \[ f_i\cdot m_{jk}-f_j\cdot m_{ik}+f_k\cdot m_{ij}=0 \rlap{.}\]
  Let $r_i$ such that $\sum r_i f_i =1$.
  Then for
  \[ u_i \coloneqq -\sum_{k=1}^l\frac{r_k}{f_i}m_{ik} \]
  we have:
  \begin{align*}
      u_j-u_i &= -\sum_{k=1}^l\frac{r_k}{f_j}m_{jk} + \sum_{k=1}^l\frac{r_k}{f_i}m_{ik} \\
              &= -\sum_{k=1}^l\frac{r_k}{f_j f_i}f_i m_{jk} + \sum_{k=1}^l\frac{r_k}{f_i f_j} f_j m_{ik} \\
              &= \sum_{k=1}^l\frac{r_k}{f_j f_i}(-f_i m_{jk} + f_j m_{ik}) \\
              &= \sum_{k=1}^l\frac{r_k}{f_j f_i}f_k m_{ij} \\
              &= \frac{m_{ij}}{f_i f_j}
  \end{align*}
  \ %
\end{proof}

\begin{theorem}[using \axiomref{Z-choice}]
  For any affine scheme $X=\Spec(A)$ and coefficients $M: X\to \fpMod{R}$, we have
  \[ H^1(X,M)=0 \rlap{.} \]
\end{theorem}
\begin{proof}
  We need to show, that any $M$-torsor $T$ on $X$ is merely equal to the trivial torsor $M$,
  or equivalently show the existence of a section of $T$.
  We have
  \[ \prod_{x:X}\| T_x \|\]
  and therefore, by (\axiomref{Z-choice}),
  there merely are $f_1,\dots,f_l:A$,
  such that the $U_i\coloneqq \Spec(A_{f_i})$ cover $X$ and
  there are local sections
  \[ s_i:\prod_{x:U_i}T_x\]
  of $T$. Our goal is to construct a matching family from the $s_i$.
  On intersections, let $t_{ij}\coloneqq s_i-s_j$ be the difference, so $t_{ij}:(x : U_i\cap U_j) \to M_x$.
  By \cref{thm:fp-module} equivalently, we have $t_{ij}:\tilde{M}_{f_i f_j}$.
  Since the $t_{ij}$ were defined as differences,
  the condition in \cref{lem:H1-algebra} is satisfied and we get
  $u_i:\tilde{M}_{f_i}$, such that $t_{ij}=u_i-u_j$.
  So we merely have a matching family $\tilde{s}_i\coloneqq s_i-u_i$ and therefore merely a section of $T$.
\end{proof}
